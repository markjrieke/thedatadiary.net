<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>the data diary</title>
<link>https://www.thedatadiary.net/index.html</link>
<atom:link href="https://www.thedatadiary.net/index.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.2.335</generator>
<lastBuildDate>Sun, 14 Nov 2021 06:00:00 GMT</lastBuildDate>
<item>
  <title>Diamonds are Forever</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index.html</link>
  <description><![CDATA[ 




<p>Are y’all ready for some charts?? This week, I did a bit of machine learning practice with the <a href="https://ggplot2.tidyverse.org/reference/diamonds.html"><code>diamonds dataset</code></a>. This dataset is interesting and good for practice for a few reasons:</p>
<ul>
<li>there are lots of observations (50,000+);</li>
<li>it includes a mix of numeric and categorical variables;</li>
<li>there are some data oddities to deal with (log scales, interactions, non-linear relations)</li>
</ul>
<p>I’ll be doing a bit of feature engineering prior to fitting an tuning a linear model that predicts the each diamond’s <code>price</code> with the <a href="https://glmnet.stanford.edu/index.html"><code>glmnet</code></a> package. This will give a good end-to-end glimpse into the data exploration and model fitting process! Before we get into that, let’s load some packages and get a preview of the dataset.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_52eb7fa85098fc0f961f0bee23b6b4a6">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(tidymodels)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(vip)</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">theme_set</span>(<span class="fu" style="color: #4758AB;">theme_minimal</span>())</span>
<span id="cb1-6"></span>
<span id="cb1-7">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;">slice_head</span>(<span class="at" style="color: #657422;">n =</span> <span class="dv" style="color: #AD0000;">10</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 10
   carat cut       color clarity depth table price     x     y     z
   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
 2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
 3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
 4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
 5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
 6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48
 7  0.24 Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47
 8  0.26 Very Good H     SI1      61.9    55   337  4.07  4.11  2.53
 9  0.22 Fair      E     VS2      65.1    61   337  3.87  3.78  2.49
10  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39</code></pre>
</div>
</div>
<p>Since we’re predicting price, let’s look at its distribution first.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_8671c2bf7c62e4d9ef60b00ba3f94f42">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> price)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>We’re definitely gonna want to apply a transformation to the price when modeling - let’s look at the distribution on a log-10 scale.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_ec04d60e73849623d88317b8961753a4">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> price)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;">scale_x_log10</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>That’s a lot more evenly distributed, if not perfect. That’s a fine starting point, so now we’ll look through the rest of the data.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_1ce43702bb2b698feafb9af1dcf15754">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> carat)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> cut,</span>
<span id="cb6-3">             <span class="at" style="color: #657422;">y =</span> price)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;">geom_boxplot</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">count</span>(cut) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> cut,</span>
<span id="cb7-4">             <span class="at" style="color: #657422;">y =</span> n)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;">geom_col</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> color,</span>
<span id="cb8-3">             <span class="at" style="color: #657422;">y =</span> price)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;">geom_boxplot</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-4.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;">count</span>(color) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> color,</span>
<span id="cb9-4">             <span class="at" style="color: #657422;">y =</span> n)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;">geom_col</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-5.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> clarity,</span>
<span id="cb10-3">             <span class="at" style="color: #657422;">y =</span> price)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;">geom_boxplot</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-6.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;">count</span>(clarity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> clarity,</span>
<span id="cb11-4">             <span class="at" style="color: #657422;">y =</span> n)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;">geom_col</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-7.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> depth)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-8.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> table)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>() </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-9.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> x)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-10.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> y)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>() </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-11.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> z)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-4-12.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>It looks like there may be a good opportunity to try out a few normalization and resampling techniques, but before we get into any of that, let’s build a baseline linear model.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_775f1abc0eabd87e927653008e7936fd">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;"># splits</span></span>
<span id="cb17-2">diamonds_split <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">initial_split</span>(diamonds)</span>
<span id="cb17-3">diamonds_train <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">training</span>(diamonds_split)</span>
<span id="cb17-4">diamonds_test <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">testing</span>(diamonds_split)</span>
<span id="cb17-5"></span>
<span id="cb17-6"><span class="co" style="color: #5E5E5E;"># resamples (don't want to use testing data!)</span></span>
<span id="cb17-7">diamonds_folds <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">vfold_cv</span>(diamonds_train)</span>
<span id="cb17-8"></span>
<span id="cb17-9"><span class="co" style="color: #5E5E5E;"># model spec</span></span>
<span id="cb17-10">mod01 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb17-11">  <span class="fu" style="color: #4758AB;">linear_reg</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-12">  <span class="fu" style="color: #4758AB;">set_engine</span>(<span class="st" style="color: #20794D;">"lm"</span>)</span>
<span id="cb17-13"></span>
<span id="cb17-14"><span class="co" style="color: #5E5E5E;"># recipe</span></span>
<span id="cb17-15">rec01 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb17-16">  <span class="fu" style="color: #4758AB;">recipe</span>(price <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-17">  <span class="fu" style="color: #4758AB;">step_dummy</span>(<span class="fu" style="color: #4758AB;">all_nominal_predictors</span>())</span>
<span id="cb17-18"></span>
<span id="cb17-19"><span class="co" style="color: #5E5E5E;"># controls</span></span>
<span id="cb17-20">ctrl_preds <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb17-21">  <span class="fu" style="color: #4758AB;">control_resamples</span>(<span class="at" style="color: #657422;">save_pred =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb17-22"></span>
<span id="cb17-23"><span class="co" style="color: #5E5E5E;"># create a wf</span></span>
<span id="cb17-24">wf01 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb17-25">  <span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-26">  <span class="fu" style="color: #4758AB;">add_model</span>(mod01) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-27">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rec01)</span>
<span id="cb17-28"></span>
<span id="cb17-29"><span class="co" style="color: #5E5E5E;"># parallel processing</span></span>
<span id="cb17-30">doParallel<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">registerDoParallel</span>()</span>
<span id="cb17-31"></span>
<span id="cb17-32"><span class="co" style="color: #5E5E5E;"># fit</span></span>
<span id="cb17-33">rs01 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb17-34">  <span class="fu" style="color: #4758AB;">fit_resamples</span>(</span>
<span id="cb17-35">    wf01,</span>
<span id="cb17-36">    diamonds_folds,</span>
<span id="cb17-37">    <span class="at" style="color: #657422;">control =</span> ctrl_preds</span>
<span id="cb17-38">  )</span>
<span id="cb17-39"></span>
<span id="cb17-40"><span class="co" style="color: #5E5E5E;"># metrics!</span></span>
<span id="cb17-41"><span class="fu" style="color: #4758AB;">collect_metrics</span>(rs01)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator     mean     n  std_err .config             
  &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   1137.       10 10.7     Preprocessor1_Model1
2 rsq     standard      0.919    10  0.00175 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>And right off the bat, we can see a fairly high value for <code>rsq</code>! However, <code>rsq</code> doesn’t tell the whole story, so we should check our predictions and residuals plots.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_10a8c8d29e16e7518fa5dab9e23ac327">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;">augment</span>(rs01) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> price,</span>
<span id="cb19-3">             <span class="at" style="color: #657422;">y =</span> .pred)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.01</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;">geom_abline</span>(<span class="at" style="color: #657422;">linetype =</span> <span class="st" style="color: #20794D;">"dashed"</span>,</span>
<span id="cb19-6">              <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.1</span>,</span>
<span id="cb19-7">              <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>This is <em>definitely</em> not what we want to see! It looks like there’s an odd curve/structure to the graph and we’re actually predicting quite a few negative values. The residuals plot doesn’t look too great either.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_e3253f32f12a947a55fc02d9aff4ccec">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;">augment</span>(rs01) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> price,</span>
<span id="cb20-3">             <span class="at" style="color: #657422;">y =</span> .resid)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.01</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb20-5">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="at" style="color: #657422;">yintercept =</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb20-6">             <span class="at" style="color: #657422;">linetype =</span> <span class="st" style="color: #20794D;">"dashed"</span>,</span>
<span id="cb20-7">             <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb20-8">             <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.1</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>What we’d like to see is a 0-correlation plot with errors normally distributed; what we’re seeing instead, however, is a ton of structure.</p>
<p>That being said, that’s okay! we expected this first pass to be pretty rough! And the price is <em>clearly</em> on a log-10 scale. To make apples-apples comparisons with models going forward, I’ll retrain this basic linear model to predict the <code>log10(price)</code>. This’ll involve a bit of data re-manipulation!</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_ec66dcd6ef098544c357a5a159308981">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;"># log transform price</span></span>
<span id="cb21-2">diamonds_model <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb21-3">  diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">price =</span> <span class="fu" style="color: #4758AB;">log10</span>(price),</span>
<span id="cb21-5">         <span class="fu" style="color: #4758AB;">across</span>(cut<span class="sc" style="color: #5E5E5E;">:</span>clarity, as.character))</span>
<span id="cb21-6"></span>
<span id="cb21-7"><span class="co" style="color: #5E5E5E;"># bad practice copy + paste lol</span></span>
<span id="cb21-8"></span>
<span id="cb21-9"><span class="co" style="color: #5E5E5E;"># splits</span></span>
<span id="cb21-10"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">999</span>)</span>
<span id="cb21-11">diamonds_split <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">initial_split</span>(diamonds_model)</span>
<span id="cb21-12">diamonds_train <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">training</span>(diamonds_split)</span>
<span id="cb21-13">diamonds_test <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">testing</span>(diamonds_split)</span>
<span id="cb21-14"></span>
<span id="cb21-15"><span class="co" style="color: #5E5E5E;"># resamples (don't want to use testing data!)</span></span>
<span id="cb21-16"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">888</span>)</span>
<span id="cb21-17">diamonds_folds <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">vfold_cv</span>(diamonds_train)</span>
<span id="cb21-18"></span>
<span id="cb21-19"><span class="co" style="color: #5E5E5E;"># model spec</span></span>
<span id="cb21-20">mod01 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb21-21">  <span class="fu" style="color: #4758AB;">linear_reg</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb21-22">  <span class="fu" style="color: #4758AB;">set_engine</span>(<span class="st" style="color: #20794D;">"lm"</span>)</span>
<span id="cb21-23"></span>
<span id="cb21-24"><span class="co" style="color: #5E5E5E;"># recipe</span></span>
<span id="cb21-25">rec01 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb21-26">  <span class="fu" style="color: #4758AB;">recipe</span>(price <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb21-27">  <span class="fu" style="color: #4758AB;">step_dummy</span>(<span class="fu" style="color: #4758AB;">all_nominal_predictors</span>())</span>
<span id="cb21-28"></span>
<span id="cb21-29"><span class="co" style="color: #5E5E5E;"># controls</span></span>
<span id="cb21-30">ctrl_preds <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb21-31">  <span class="fu" style="color: #4758AB;">control_resamples</span>(<span class="at" style="color: #657422;">save_pred =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb21-32"></span>
<span id="cb21-33"><span class="co" style="color: #5E5E5E;"># create a wf</span></span>
<span id="cb21-34">wf01 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb21-35">  <span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb21-36">  <span class="fu" style="color: #4758AB;">add_model</span>(mod01) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb21-37">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rec01)</span>
<span id="cb21-38"></span>
<span id="cb21-39"><span class="co" style="color: #5E5E5E;"># parallel processing</span></span>
<span id="cb21-40">doParallel<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">registerDoParallel</span>()</span>
<span id="cb21-41"></span>
<span id="cb21-42"><span class="co" style="color: #5E5E5E;"># fit</span></span>
<span id="cb21-43"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">777</span>)</span>
<span id="cb21-44">rs01 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb21-45">  <span class="fu" style="color: #4758AB;">fit_resamples</span>(</span>
<span id="cb21-46">    wf01,</span>
<span id="cb21-47">    diamonds_folds,</span>
<span id="cb21-48">    <span class="at" style="color: #657422;">control =</span> ctrl_preds</span>
<span id="cb21-49">  )</span>
<span id="cb21-50"></span>
<span id="cb21-51"><span class="co" style="color: #5E5E5E;"># metrics!</span></span>
<span id="cb21-52"><span class="fu" style="color: #4758AB;">collect_metrics</span>(rs01)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator   mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   0.0793    10 0.00557 Preprocessor1_Model1
2 rsq     standard   0.966     10 0.00494 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>And wow, that <em>one</em> transformation increased our <code>rsq</code> to 0.96! Again, that’s not the whole story, and we’re going to be evaluating models based on the <code>rmse</code>. Let’s look at how our prediction map has updated:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-9_0701ecd4e357da1b73181e8f8e7858c9">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">rs01 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;">augment</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> price,</span>
<span id="cb23-4">             <span class="at" style="color: #657422;">y =</span> .pred)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb23-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.01</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb23-6">  <span class="fu" style="color: #4758AB;">geom_abline</span>(<span class="at" style="color: #657422;">linetype =</span> <span class="st" style="color: #20794D;">"dashed"</span>,</span>
<span id="cb23-7">              <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.1</span>,</span>
<span id="cb23-8">              <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>) </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Now <em>that</em> is a much better starting place to be at! Let’s look at our coefficients</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-10_f9fbdbf67537bba7b6a6fcb0faacc62a">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">666</span>) <span class="co" style="color: #5E5E5E;"># :thedevilisalive:</span></span>
<span id="cb24-2">wf01 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;">fit</span>(diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;">pull_workflow_fit</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-5">  vip<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">vi</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">Variable =</span> <span class="fu" style="color: #4758AB;">fct_reorder</span>(Variable, Importance)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-7">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> Variable,</span>
<span id="cb24-8">             <span class="at" style="color: #657422;">y =</span> Importance,</span>
<span id="cb24-9">             <span class="at" style="color: #657422;">fill =</span> Sign)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb24-10">  <span class="fu" style="color: #4758AB;">geom_col</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb24-11">  <span class="fu" style="color: #4758AB;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb24-12">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">plot.title.position =</span> <span class="st" style="color: #20794D;">"plot"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb24-13">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">x =</span> <span class="cn" style="color: #8f5902;">NULL</span>,</span>
<span id="cb24-14">       <span class="at" style="color: #657422;">y =</span> <span class="cn" style="color: #8f5902;">NULL</span>,</span>
<span id="cb24-15">       <span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">"Diamonds are forever"</span>,</span>
<span id="cb24-16">       <span class="at" style="color: #657422;">subtitle =</span> <span class="st" style="color: #20794D;">"Variable importance plot of a basic linear regression predicting diamond price"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Another way of looking at it:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_39086d7fc89846ac3b52322a0bbc2c1e">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">666</span>)</span>
<span id="cb25-2">wf01 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;">fit</span>(diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb25-4">  <span class="fu" style="color: #4758AB;">pull_workflow_fit</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb25-5">  vip<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">vi</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb25-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">Importance =</span> <span class="fu" style="color: #4758AB;">if_else</span>(Sign <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"NEG"</span>, Importance <span class="sc" style="color: #5E5E5E;">*</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>, Importance),</span>
<span id="cb25-7">         <span class="at" style="color: #657422;">Variable =</span> <span class="fu" style="color: #4758AB;">fct_reorder</span>(Variable, Importance)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb25-8">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> Variable,</span>
<span id="cb25-9">             <span class="at" style="color: #657422;">y =</span> Importance,</span>
<span id="cb25-10">             <span class="at" style="color: #657422;">fill =</span> Sign)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb25-11">  <span class="fu" style="color: #4758AB;">geom_col</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb25-12">  <span class="fu" style="color: #4758AB;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb25-13">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">"Diamonds are forever"</span>,</span>
<span id="cb25-14">       <span class="at" style="color: #657422;">subtitle =</span> <span class="st" style="color: #20794D;">"Variable importance plot of a basic linear regression predicting diamond price"</span>,</span>
<span id="cb25-15">       <span class="at" style="color: #657422;">x =</span> <span class="cn" style="color: #8f5902;">NULL</span>,</span>
<span id="cb25-16">       <span class="at" style="color: #657422;">y =</span> <span class="cn" style="color: #8f5902;">NULL</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb25-17">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">plot.title.position =</span> <span class="st" style="color: #20794D;">"plot"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>This is a good, but definitely improvable, starting point. We can likely decrease our overall error with a bit of feature engineering and drop unimportant features by tuning a regularized model. There are some oddities in this initial model that will need to be improved upon; for one, we can definitively say that the <code>carat</code> feature ought to be <em>positively</em> associated with price</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_1412bb03fc60774512478bba367fb23e">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> carat,</span>
<span id="cb26-3">             <span class="at" style="color: #657422;">y =</span> price)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.01</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">"A clear positive (albeit nonlinear) relationship between `carat` and `price`"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb26-6">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">plot.title.position =</span> <span class="st" style="color: #20794D;">"plot"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Another few things that are interesting to note in this plot! It looks like there are clusterings of carat ratings around round-ish numbers. My hypothesis here is that carat ratings tend to get rounded up to the next size. There’s also a clear abscence of diamonds priced at $1,500 (~3.17 on the log10 scale). I suppose there is some industry-specific reason to avoid a diamond price of $,1500?</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-13_fabc275dc0af918cab59afca8f583d67">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> carat,</span>
<span id="cb27-3">             <span class="at" style="color: #657422;">y =</span> price)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.01</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">"A clear positive (albeit nonlinear) relationship between `carat` and `price`"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">plot.title.position =</span> <span class="st" style="color: #20794D;">"plot"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="at" style="color: #657422;">yintercept =</span> <span class="fu" style="color: #4758AB;">log10</span>(<span class="dv" style="color: #AD0000;">1500</span>),</span>
<span id="cb27-8">             <span class="at" style="color: #657422;">linetype =</span> <span class="st" style="color: #20794D;">"dashed"</span>,</span>
<span id="cb27-9">             <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.9</span>,</span>
<span id="cb27-10">             <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>How to address all these things? With some feature engineering! Firstly, let’s add some recipe steps to balance classes &amp; normalize continuous variables.</p>
<p>But before I get into <em>that</em>, I’ll save the resample metrics so that we can compare models!</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-14_73d5aa3f138121edc7fe44069d9cf9e5">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">metrics <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">collect_metrics</span>(rs01) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">model =</span> <span class="st" style="color: #20794D;">"model01"</span>)</span>
<span id="cb28-2"></span>
<span id="cb28-3">metrics</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  .metric .estimator   mean     n std_err .config              model  
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt;  
1 rmse    standard   0.0793    10 0.00557 Preprocessor1_Model1 model01
2 rsq     standard   0.966     10 0.00494 Preprocessor1_Model1 model01</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-15_ab8644a6adc94dcd204963c57e6226f0">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;"># spec will be the same as model01</span></span>
<span id="cb30-2">mod02 <span class="ot" style="color: #003B4F;">&lt;-</span> mod01</span>
<span id="cb30-3"></span>
<span id="cb30-4"><span class="co" style="color: #5E5E5E;"># recipe!</span></span>
<span id="cb30-5">rec02 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb30-6">  <span class="fu" style="color: #4758AB;">recipe</span>(price <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb30-7">  <span class="fu" style="color: #4758AB;">step_other</span>(cut, color, clarity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-8">  <span class="fu" style="color: #4758AB;">step_dummy</span>(<span class="fu" style="color: #4758AB;">all_nominal_predictors</span>(), <span class="sc" style="color: #5E5E5E;">-</span>cut) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb30-9">  </span>
<span id="cb30-10">  <span class="co" style="color: #5E5E5E;"># use smote resampling to balance classes</span></span>
<span id="cb30-11">  themis<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">step_smote</span>(cut) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-12">    </span>
<span id="cb30-13">  <span class="co" style="color: #5E5E5E;"># normalize continuous vars</span></span>
<span id="cb30-14">  bestNormalize<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">step_best_normalize</span>(carat, depth, table, x, y, z)</span></code></pre></div>
</details>
</div>
<p>Let’s <a href="https://recipes.tidymodels.org/reference/bake.html">bake</a> our recipe to verify that everything looks up-to-snuff in the preprocessed dataset.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-16_f9588de3fe4bc53e956254f0d71938c5">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">baked_rec02 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb31-2">  rec02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;">prep</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb31-4">  <span class="fu" style="color: #4758AB;">bake</span>(<span class="at" style="color: #657422;">new_data =</span> <span class="cn" style="color: #8f5902;">NULL</span>)</span>
<span id="cb31-5"></span>
<span id="cb31-6">baked_rec02</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80,495 × 20
     carat cut        depth  table       x       y      z price color_E color_F
     &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 -0.706  Premium    0.138 -0.760 -0.709  -0.738  -0.695  3.01       0       1
 2  0.356  Very Good  0.570  0.835  0.342   0.251   0.344  3.63       0       0
 3  0.214  Premium   -0.308  0.835  0.293   0.263   0.166  3.58       0       0
 4 -1.08   other      1.04  -0.310 -1.30   -1.40   -0.995  2.70       0       0
 5 -0.641  Ideal     -0.602 -0.760 -0.595  -0.560  -0.622  2.97       0       0
 6 -0.0759 Premium   -0.602  0.494 -0.0349 -0.0460 -0.114  3.38       0       0
 7 -0.149  Premium   -1.16   0.103 -0.0565 -0.0842 -0.246  3.44       1       0
 8  0.170  Very Good -0.371  0.494  0.178   0.313   0.130  3.56       0       1
 9 -0.736  Ideal     -0.110 -0.760 -0.709  -0.738  -0.723  3.09       0       0
10  0.782  Ideal     -0.602 -0.310  0.819   0.846   0.732  4.02       0       0
# … with 80,485 more rows, and 10 more variables: color_G &lt;dbl&gt;, color_H &lt;dbl&gt;,
#   color_I &lt;dbl&gt;, color_J &lt;dbl&gt;, clarity_SI2 &lt;dbl&gt;, clarity_VS1 &lt;dbl&gt;,
#   clarity_VS2 &lt;dbl&gt;, clarity_VVS1 &lt;dbl&gt;, clarity_VVS2 &lt;dbl&gt;,
#   clarity_other &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-17_a82128c2cdbc56f3d1f9de39624c49fb">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">baked_rec02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb33-2">  <span class="fu" style="color: #4758AB;">count</span>(cut) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb33-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> cut,</span>
<span id="cb33-4">             <span class="at" style="color: #657422;">y =</span> n)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb33-5">  <span class="fu" style="color: #4758AB;">geom_col</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">baked_rec02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> carat)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb34-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">baked_rec02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb35-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> depth)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb35-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-17-3.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">baked_rec02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb36-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> table)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-17-4.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">baked_rec02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb37-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> x)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb37-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-17-5.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">baked_rec02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb38-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> y)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb38-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>() </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-17-6.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1">baked_rec02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb39-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> z)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb39-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-17-7.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Everything looks alright with the exception of the <code>table</code> predictor. I wonder if there are a lot of repeated values in the <code>table</code> variable - that may be why we’re seeing a “chunky” histogram. Let’s check</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-18_a270a4cdb76b081d4f1bd7c049dd7640">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">baked_rec02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb40-2">  <span class="fu" style="color: #4758AB;">count</span>(table) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb40-3">  <span class="fu" style="color: #4758AB;">arrange</span>(<span class="fu" style="color: #4758AB;">desc</span>(n))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,406 × 2
    table     n
    &lt;dbl&gt; &lt;int&gt;
 1  0.103 12167
 2 -0.310 11408
 3 -0.760 11031
 4  0.494  9406
 5 -1.28   6726
 6  0.835  6165
 7  1.15   3810
 8 -1.85   2789
 9  1.42   2182
10  1.64    972
# … with 10,396 more rows</code></pre>
</div>
</div>
<p>Ooh - okay yeah that’s definitely the issue! I’m not <em>quite</em> sure how to deal with it, so we’re just going to ignore for now! Let’s add a new model &amp; see how it compares against the baseline transformed model.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-19_ee4e1cc9b7f50e6fafc49aaa807c705e">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">wf02 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb42-2">  <span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb42-3">  <span class="fu" style="color: #4758AB;">add_model</span>(mod02) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb42-4">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rec02)</span>
<span id="cb42-5"></span>
<span id="cb42-6"><span class="co" style="color: #5E5E5E;"># stop parallel to avoid error!</span></span>
<span id="cb42-7"><span class="co" style="color: #5E5E5E;"># need to replace with PSOCK clusters</span></span>
<span id="cb42-8"><span class="co" style="color: #5E5E5E;"># see github issue here: https://github.com/tidymodels/recipes/issues/847</span></span>
<span id="cb42-9">foreach<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">registerDoSEQ</span>()</span>
<span id="cb42-10"></span>
<span id="cb42-11"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">666</span>) <span class="co" style="color: #5E5E5E;"># spoopy</span></span>
<span id="cb42-12">rs02 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb42-13">  <span class="fu" style="color: #4758AB;">fit_resamples</span>(</span>
<span id="cb42-14">    wf02,</span>
<span id="cb42-15">    diamonds_folds,</span>
<span id="cb42-16">    <span class="at" style="color: #657422;">control =</span> ctrl_preds</span>
<span id="cb42-17">  )</span>
<span id="cb42-18"></span>
<span id="cb42-19"><span class="fu" style="color: #4758AB;">collect_metrics</span>(rs02)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   0.115    10 0.00143 Preprocessor1_Model1
2 rsq     standard   0.932    10 0.00161 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>Oof - that’s actually slightly worse than our baseline model!</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-20_21340b76cd21098cc294178f7f81dfc2">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">rs02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb44-2">  <span class="fu" style="color: #4758AB;">augment</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb44-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> price,</span>
<span id="cb44-4">             <span class="at" style="color: #657422;">y =</span> .pred)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb44-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.01</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb44-6">  <span class="fu" style="color: #4758AB;">geom_abline</span>(<span class="at" style="color: #657422;">linetype =</span> <span class="st" style="color: #20794D;">"dashed"</span>,</span>
<span id="cb44-7">              <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.1</span>,</span>
<span id="cb44-8">              <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>) </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>It looks like we’ve introduced structure into the residual plot!</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-21_0ba2d6c954a2d6b29585a6cd42beb0b3">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1">rs02 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb45-2">  <span class="fu" style="color: #4758AB;">augment</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb45-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> price,</span>
<span id="cb45-4">             <span class="at" style="color: #657422;">y =</span> .resid)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb45-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.01</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb45-6">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="at" style="color: #657422;">yintercept =</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb45-7">             <span class="at" style="color: #657422;">linetype =</span> <span class="st" style="color: #20794D;">"dashed"</span>,</span>
<span id="cb45-8">             <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.1</span>,</span>
<span id="cb45-9">             <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Yeah that’s fairly wonky! I’m wondering if it’s due to the SMOTE upsampling method we introduced? To counteract, I’ll build &amp; train new models after each set of recipe steps (e.g., resampling, normalizing, interactions) to buil up a better performing model one step at a time.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-22_5f1ed1a52f4bb54f9653ea481cf8335b">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1">metrics <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb46-2">  metrics <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-3">  <span class="fu" style="color: #4758AB;">bind_rows</span>(<span class="fu" style="color: #4758AB;">collect_metrics</span>(rs02) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">model =</span> <span class="st" style="color: #20794D;">"model02"</span>))</span></code></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-23_d4e4a66de9366e84d142da7f76b1d6b1">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><span class="co" style="color: #5E5E5E;"># same model spec</span></span>
<span id="cb47-2">mod03 <span class="ot" style="color: #003B4F;">&lt;-</span> mod02</span>
<span id="cb47-3"></span>
<span id="cb47-4"><span class="co" style="color: #5E5E5E;"># rebuild rec+wf &amp; retrain</span></span>
<span id="cb47-5">rec03 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb47-6">  <span class="fu" style="color: #4758AB;">recipe</span>(price <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb47-7">  <span class="fu" style="color: #4758AB;">step_other</span>(cut, color, clarity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb47-8">  <span class="fu" style="color: #4758AB;">step_dummy</span>(<span class="fu" style="color: #4758AB;">all_nominal_predictors</span>(), <span class="sc" style="color: #5E5E5E;">-</span>cut) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb47-9">  themis<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">step_smote</span>(cut)</span>
<span id="cb47-10"></span>
<span id="cb47-11">wf03 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb47-12">  <span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb47-13">  <span class="fu" style="color: #4758AB;">add_model</span>(mod03) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb47-14">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rec03)</span>
<span id="cb47-15"></span>
<span id="cb47-16"><span class="co" style="color: #5E5E5E;"># do paralllel</span></span>
<span id="cb47-17">doParallel<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">registerDoParallel</span>()</span>
<span id="cb47-18"></span>
<span id="cb47-19"><span class="co" style="color: #5E5E5E;"># refit!</span></span>
<span id="cb47-20"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb47-21">rs03 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb47-22">  <span class="fu" style="color: #4758AB;">fit_resamples</span>(</span>
<span id="cb47-23">    wf03,</span>
<span id="cb47-24">    diamonds_folds,</span>
<span id="cb47-25">    <span class="at" style="color: #657422;">control =</span> ctrl_preds</span>
<span id="cb47-26">  )</span>
<span id="cb47-27"></span>
<span id="cb47-28"><span class="fu" style="color: #4758AB;">collect_metrics</span>(rs03)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator   mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   0.0918    10 0.00502 Preprocessor1_Model1
2 rsq     standard   0.956     10 0.00502 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>Interesting! Improved relative to <code>rs02</code>, but still not as good as our first model! Let’s try using <code>step_downsample()</code> to balance classes &amp; see how we fare.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-24_e03b0539bd5a7826146d9580fd0a98ba">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><span class="co" style="color: #5E5E5E;"># cleanup some large-ish items eating up memory</span></span>
<span id="cb49-2"><span class="fu" style="color: #4758AB;">rm</span>(mod01, mod02, rec01, rec02, wf01, wf02, rs01, rs02)</span>
<span id="cb49-3"></span>
<span id="cb49-4"><span class="co" style="color: #5E5E5E;"># save metrics</span></span>
<span id="cb49-5">metrics <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb49-6">  metrics <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb49-7">  <span class="fu" style="color: #4758AB;">bind_rows</span>(<span class="fu" style="color: #4758AB;">collect_metrics</span>(rs03) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">model =</span> <span class="st" style="color: #20794D;">"model03"</span>))</span>
<span id="cb49-8"></span>
<span id="cb49-9"><span class="co" style="color: #5E5E5E;"># new mod</span></span>
<span id="cb49-10">mod04 <span class="ot" style="color: #003B4F;">&lt;-</span> mod03</span>
<span id="cb49-11"></span>
<span id="cb49-12"><span class="co" style="color: #5E5E5E;"># new rec</span></span>
<span id="cb49-13">rec04 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb49-14">  <span class="fu" style="color: #4758AB;">recipe</span>(price <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb49-15">  <span class="fu" style="color: #4758AB;">step_other</span>(cut, color, clarity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb49-16">  <span class="fu" style="color: #4758AB;">step_dummy</span>(<span class="fu" style="color: #4758AB;">all_nominal_predictors</span>(), <span class="sc" style="color: #5E5E5E;">-</span>cut) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb49-17">  themis<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">step_downsample</span>(cut)</span>
<span id="cb49-18"></span>
<span id="cb49-19">wf04 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb49-20">  <span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb49-21">  <span class="fu" style="color: #4758AB;">add_model</span>(mod04) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb49-22">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rec04) </span>
<span id="cb49-23"></span>
<span id="cb49-24"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">456</span>) </span>
<span id="cb49-25">rs04 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb49-26">  <span class="fu" style="color: #4758AB;">fit_resamples</span>(</span>
<span id="cb49-27">    wf04,</span>
<span id="cb49-28">    diamonds_folds,</span>
<span id="cb49-29">    <span class="at" style="color: #657422;">control =</span> ctrl_preds</span>
<span id="cb49-30">  )</span>
<span id="cb49-31"></span>
<span id="cb49-32"><span class="fu" style="color: #4758AB;">collect_metrics</span>(rs04)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   0.113    10  0.0120 Preprocessor1_Model1
2 rsq     standard   0.930    10  0.0153 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>Wow - still a bit worse! I’ll try upsampling &amp; if there is no improvement, we’ll move on without resampling!</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-25_79da622e98d977f1fbc0f7ec4ddfb58e">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1">metrics <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb51-2">  metrics <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb51-3">  <span class="fu" style="color: #4758AB;">bind_rows</span>(<span class="fu" style="color: #4758AB;">collect_metrics</span>(rs04) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">model =</span> <span class="st" style="color: #20794D;">"model04"</span>))</span>
<span id="cb51-4"></span>
<span id="cb51-5">mod05 <span class="ot" style="color: #003B4F;">&lt;-</span> mod04</span>
<span id="cb51-6"></span>
<span id="cb51-7">rec05 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb51-8">  <span class="fu" style="color: #4758AB;">recipe</span>(price <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb51-9">  <span class="fu" style="color: #4758AB;">step_other</span>(cut, color, clarity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb51-10">  <span class="fu" style="color: #4758AB;">step_dummy</span>(<span class="fu" style="color: #4758AB;">all_nominal_predictors</span>(), <span class="sc" style="color: #5E5E5E;">-</span>cut) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb51-11">  themis<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">step_upsample</span>(cut)</span>
<span id="cb51-12"></span>
<span id="cb51-13">wf05 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb51-14">  <span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb51-15">  <span class="fu" style="color: #4758AB;">add_model</span>(mod05) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb51-16">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rec05) </span>
<span id="cb51-17"></span>
<span id="cb51-18"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">789</span>)</span>
<span id="cb51-19">rs05 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb51-20">  <span class="fu" style="color: #4758AB;">fit_resamples</span>(</span>
<span id="cb51-21">    wf05,</span>
<span id="cb51-22">    diamonds_folds,</span>
<span id="cb51-23">    <span class="at" style="color: #657422;">control =</span> ctrl_preds</span>
<span id="cb51-24">  )</span>
<span id="cb51-25"></span>
<span id="cb51-26"><span class="fu" style="color: #4758AB;">collect_metrics</span>(rs05)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   0.101    10 0.00486 Preprocessor1_Model1
2 rsq     standard   0.946    10 0.00527 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>Okay - resampling gets stricken off our list of recipe steps! Let’s look at how the models compare so far</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-26_bf179ddbfb0904fe5bb034287b5c3270">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1">metrics <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb53-2">  metrics <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-3">  <span class="fu" style="color: #4758AB;">bind_rows</span>(<span class="fu" style="color: #4758AB;">collect_metrics</span>(rs05) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">model =</span> <span class="st" style="color: #20794D;">"model05"</span>))</span>
<span id="cb53-4"></span>
<span id="cb53-5">metrics <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-6">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> model)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb53-7">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y =</span> mean)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb53-8">  <span class="fu" style="color: #4758AB;">geom_errorbar</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">ymin =</span> mean <span class="sc" style="color: #5E5E5E;">-</span> std_err,</span>
<span id="cb53-9">                    <span class="at" style="color: #657422;">ymax =</span> mean <span class="sc" style="color: #5E5E5E;">+</span> std_err)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb53-10">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span>.metric, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free_y"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>The first simple linear model was the best as measured by both metrics! Let’s see if we can improve with some normalization of the continuous vars.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-27_815491b6129f102975d33c0ccf6defba">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="fu" style="color: #4758AB;">rm</span>(mod03, mod04, rec03, rec04, rs03, rs04, wf03, wf04)</span>
<span id="cb54-2"></span>
<span id="cb54-3">mod06 <span class="ot" style="color: #003B4F;">&lt;-</span> mod05</span>
<span id="cb54-4"></span>
<span id="cb54-5">rec06 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb54-6">  <span class="fu" style="color: #4758AB;">recipe</span>(price <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb54-7">  <span class="fu" style="color: #4758AB;">step_other</span>(cut, color, clarity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb54-8">  bestNormalize<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">step_best_normalize</span>(<span class="fu" style="color: #4758AB;">all_numeric_predictors</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb54-9">  <span class="fu" style="color: #4758AB;">step_dummy</span>(<span class="fu" style="color: #4758AB;">all_nominal_predictors</span>())</span>
<span id="cb54-10"></span>
<span id="cb54-11">wf06 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb54-12">  <span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb54-13">  <span class="fu" style="color: #4758AB;">add_model</span>(mod06) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb54-14">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rec06)</span>
<span id="cb54-15"></span>
<span id="cb54-16">foreach<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">registerDoSEQ</span>()</span>
<span id="cb54-17"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">101112</span>)</span>
<span id="cb54-18">rs06 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb54-19">  <span class="fu" style="color: #4758AB;">fit_resamples</span>(</span>
<span id="cb54-20">    wf06,</span>
<span id="cb54-21">    diamonds_folds,</span>
<span id="cb54-22">    <span class="at" style="color: #657422;">control =</span> ctrl_preds</span>
<span id="cb54-23">  )</span>
<span id="cb54-24"></span>
<span id="cb54-25"><span class="fu" style="color: #4758AB;">collect_metrics</span>(rs06)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   0.127    10 0.00115 Preprocessor1_Model1
2 rsq     standard   0.916    10 0.00136 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>Well - that was quite a bit for no improvement! I guess that normalizing the continuous vars in this case isn’t helping. Moving on to adding some interactions - first let’s explore potential interactions a bit.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-28_f7ea4ed820f926556d91a2ea010805f8">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1">metrics <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb56-2">  metrics <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-3">  <span class="fu" style="color: #4758AB;">bind_rows</span>(<span class="fu" style="color: #4758AB;">collect_metrics</span>(rs06) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">model =</span> <span class="st" style="color: #20794D;">"model06"</span>))</span>
<span id="cb56-4"></span>
<span id="cb56-5">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb56-6">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> carat,</span>
<span id="cb56-7">             <span class="at" style="color: #657422;">y =</span> price,</span>
<span id="cb56-8">             <span class="at" style="color: #657422;">color =</span> cut)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb56-9">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb56-10">  <span class="fu" style="color: #4758AB;">geom_smooth</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"lm"</span>, <span class="at" style="color: #657422;">se =</span> <span class="cn" style="color: #8f5902;">FALSE</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-29_c59880c636cba809bc90161b20f6f384">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><span class="fu" style="color: #4758AB;">library</span>(splines)</span>
<span id="cb57-2">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb57-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> carat,</span>
<span id="cb57-4">             <span class="at" style="color: #657422;">y =</span> price,</span>
<span id="cb57-5">             <span class="at" style="color: #657422;">color =</span> cut)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb57-6">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb57-7">  <span class="fu" style="color: #4758AB;">geom_smooth</span>(<span class="at" style="color: #657422;">method =</span> lm,</span>
<span id="cb57-8">              <span class="at" style="color: #657422;">formula =</span> y <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">ns</span>(x, <span class="at" style="color: #657422;">df =</span> <span class="dv" style="color: #AD0000;">5</span>),</span>
<span id="cb57-9">              <span class="at" style="color: #657422;">se =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb57-10">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span>cut, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>5 spline terms might not be sufficient here - capturing the lower bound well but <em>really</em> not doing well with the higher carat diamonds.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-30_a0f83308804ccf61153ed47cf8b54b5d">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb58-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> carat,</span>
<span id="cb58-3">             <span class="at" style="color: #657422;">y =</span> price,</span>
<span id="cb58-4">             <span class="at" style="color: #657422;">color =</span> cut)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb58-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb58-6">  <span class="fu" style="color: #4758AB;">geom_smooth</span>(<span class="at" style="color: #657422;">method =</span> lm,</span>
<span id="cb58-7">              <span class="at" style="color: #657422;">formula =</span> y <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">ns</span>(x, <span class="at" style="color: #657422;">df =</span> <span class="dv" style="color: #AD0000;">10</span>),</span>
<span id="cb58-8">              <span class="at" style="color: #657422;">se =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb58-9">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span>cut, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Hmmmm, 10 might be too many. It looks lie we’ll just lose a bit of confidence for the Premium &amp; Very Good diamonds at higher carats. Relative to the total number, I’m not too concerned.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-31_c88ddd4df04a38b9d10a75b7bd7b345b">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb59-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> carat,</span>
<span id="cb59-3">             <span class="at" style="color: #657422;">y =</span> price,</span>
<span id="cb59-4">             <span class="at" style="color: #657422;">color =</span> cut)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb59-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb59-6">  <span class="fu" style="color: #4758AB;">geom_smooth</span>(<span class="at" style="color: #657422;">method =</span> lm,</span>
<span id="cb59-7">              <span class="at" style="color: #657422;">formula =</span> y <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">ns</span>(x, <span class="at" style="color: #657422;">df =</span> <span class="dv" style="color: #AD0000;">7</span>),</span>
<span id="cb59-8">              <span class="at" style="color: #657422;">se =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb59-9">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span>cut, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>7 terms feels like the best we’re going to do here - I think this is tuneable, but we’ll leave as is (now &amp; in the final model).</p>
<p>Next, we’ll look at creating interactions between the <code>color</code> and <code>carat</code> variables:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-32_b1a5c26e1d7ae30c5b78ceb143dcb9cb">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb60-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> carat, </span>
<span id="cb60-3">             <span class="at" style="color: #657422;">y =</span> price,</span>
<span id="cb60-4">             <span class="at" style="color: #657422;">color =</span> color)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb60-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb60-6">  <span class="fu" style="color: #4758AB;">geom_smooth</span>(<span class="at" style="color: #657422;">method =</span> lm, </span>
<span id="cb60-7">              <span class="at" style="color: #657422;">formula =</span> y <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">ns</span>(x, <span class="at" style="color: #657422;">df =</span> <span class="dv" style="color: #AD0000;">15</span>),</span>
<span id="cb60-8">              <span class="at" style="color: #657422;">se =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb60-9">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span>color)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Adding interactive spline terms with <code>df</code> of 15 seems to add some useful information!</p>
<p>We have three shape parameters, <code>x</code>, <code>y</code>, and <code>z</code> - I wonder if creating a stand-in for volume by multiplying them all together will provide any useful information?</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-33_0f62ae869f0fa13078cf53e176aae879">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb61-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">volume_param =</span> x <span class="sc" style="color: #5E5E5E;">*</span> y <span class="sc" style="color: #5E5E5E;">*</span> z) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb61-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> volume_param,</span>
<span id="cb61-4">             <span class="at" style="color: #657422;">y =</span> price)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb61-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Ooh, looks like we’re getting some good info here, but we may want to use <code>log10</code> to scale this back.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-34_0bc6fb25985bbff65d457adc579ad843">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb62-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">volume_param =</span> <span class="fu" style="color: #4758AB;">log10</span>(x <span class="sc" style="color: #5E5E5E;">*</span> y <span class="sc" style="color: #5E5E5E;">*</span> z)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb62-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> volume_param, </span>
<span id="cb62-4">             <span class="at" style="color: #657422;">y =</span> price)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb62-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Let’s see if this ought to interact with any other paramaters:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-35_db27896f8cbcacea832e9fb7fa95aa63">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb63-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">volume_param =</span> <span class="fu" style="color: #4758AB;">log10</span>(x <span class="sc" style="color: #5E5E5E;">*</span> y <span class="sc" style="color: #5E5E5E;">*</span> z)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb63-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> volume_param, </span>
<span id="cb63-4">             <span class="at" style="color: #657422;">y =</span> price,</span>
<span id="cb63-5">             <span class="at" style="color: #657422;">color =</span> cut)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb63-6">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb63-7">  <span class="fu" style="color: #4758AB;">geom_smooth</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"lm"</span>, <span class="at" style="color: #657422;">se =</span> <span class="cn" style="color: #8f5902;">FALSE</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb64-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">volume_param =</span> <span class="fu" style="color: #4758AB;">log10</span>(x <span class="sc" style="color: #5E5E5E;">*</span> y <span class="sc" style="color: #5E5E5E;">*</span> z)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb64-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> volume_param, </span>
<span id="cb64-4">             <span class="at" style="color: #657422;">y =</span> price,</span>
<span id="cb64-5">             <span class="at" style="color: #657422;">color =</span> color)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb64-6">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb64-7">  <span class="fu" style="color: #4758AB;">geom_smooth</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"lm"</span>, <span class="at" style="color: #657422;">se =</span> <span class="cn" style="color: #8f5902;">FALSE</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid" width="2100"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1">diamonds_train <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb65-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">volume_param =</span> <span class="fu" style="color: #4758AB;">log10</span>(x <span class="sc" style="color: #5E5E5E;">*</span> y <span class="sc" style="color: #5E5E5E;">*</span> z)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb65-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> volume_param, </span>
<span id="cb65-4">             <span class="at" style="color: #657422;">y =</span> price,</span>
<span id="cb65-5">             <span class="at" style="color: #657422;">color =</span> clarity)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb65-6">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb65-7">  <span class="fu" style="color: #4758AB;">geom_smooth</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"lm"</span>, <span class="at" style="color: #657422;">se =</span> <span class="cn" style="color: #8f5902;">FALSE</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-35-3.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Hmm, it doesn’t really look like we’re capturing too great of interactions, so I’ll leave out for now. It looks like the <em>size</em> of the rock is more important than anything else! I could continue to dig further, but I’ll stop there. I’m likely getting diminishing returns, &amp; I’d like to get back into modeling!</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-36_42b5a7ec36201328f536fbce7e9d2050">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1">mod07 <span class="ot" style="color: #003B4F;">&lt;-</span> mod06</span>
<span id="cb66-2"></span>
<span id="cb66-3">rec07 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb66-4">  <span class="fu" style="color: #4758AB;">recipe</span>(price <span class="sc" style="color: #5E5E5E;">~</span> ., <span class="at" style="color: #657422;">data =</span> diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb66-5">  <span class="fu" style="color: #4758AB;">step_other</span>(cut, color, clarity) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb66-6">  <span class="fu" style="color: #4758AB;">step_dummy</span>(<span class="fu" style="color: #4758AB;">all_nominal_predictors</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb66-7">  <span class="fu" style="color: #4758AB;">step_interact</span>(<span class="sc" style="color: #5E5E5E;">~</span>carat<span class="sc" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"cut_"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb66-8">  <span class="fu" style="color: #4758AB;">step_interact</span>(<span class="sc" style="color: #5E5E5E;">~</span>carat<span class="sc" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"color_"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb66-9">  <span class="fu" style="color: #4758AB;">step_mutate_at</span>(<span class="fu" style="color: #4758AB;">c</span>(x, y, z),</span>
<span id="cb66-10">                 <span class="at" style="color: #657422;">fn =</span> <span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">if_else</span>(.x <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="fu" style="color: #4758AB;">mean</span>(.x), .x)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb66-11">  <span class="fu" style="color: #4758AB;">step_mutate</span>(<span class="at" style="color: #657422;">volume_param =</span> <span class="fu" style="color: #4758AB;">log10</span>(x <span class="sc" style="color: #5E5E5E;">*</span> y <span class="sc" style="color: #5E5E5E;">*</span> z)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb66-12">  <span class="fu" style="color: #4758AB;">step_ns</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"carat_x_cut"</span>), <span class="at" style="color: #657422;">deg_free =</span> <span class="dv" style="color: #AD0000;">7</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb66-13">  <span class="fu" style="color: #4758AB;">step_ns</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"carat_x_color"</span>), <span class="at" style="color: #657422;">deg_free =</span> <span class="dv" style="color: #AD0000;">15</span>) </span>
<span id="cb66-14"></span>
<span id="cb66-15">rec07</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Recipe

Inputs:

      role #variables
   outcome          1
 predictor          9

Operations:

Collapsing factor levels for cut, color, clarity
Dummy variables from all_nominal_predictors()
Interactions with carat:starts_with("cut_")
Interactions with carat:starts_with("color_")
Variable mutation for c(x, y, z)
Variable mutation for log10(x * y * z)
Natural splines on starts_with("carat_x_cut")
Natural splines on starts_with("carat_x_color")</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1">wf07 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb68-2">  <span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb68-3">  <span class="fu" style="color: #4758AB;">add_model</span>(mod07) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb68-4">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rec07)</span>
<span id="cb68-5"></span>
<span id="cb68-6">doParallel<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">registerDoParallel</span>()</span>
<span id="cb68-7"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">9876</span>)</span>
<span id="cb68-8">rs07 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb68-9">  <span class="fu" style="color: #4758AB;">fit_resamples</span>(</span>
<span id="cb68-10">    wf07,</span>
<span id="cb68-11">    diamonds_folds,</span>
<span id="cb68-12">    <span class="at" style="color: #657422;">control =</span> ctrl_preds</span>
<span id="cb68-13">  )</span></code></pre></div>
</details>
</div>
<p>This is definitely going to <em>way</em> overfit our data:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-37_d864700160abd35dedd2de0acd173ce2">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1">rs07 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb69-2">  <span class="fu" style="color: #4758AB;">collect_metrics</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator   mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   0.0750    10 0.00377 Preprocessor1_Model1
2 rsq     standard   0.970     10 0.00342 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>Well we (finally) made a modes improvement! Let’s see how the predictions/residuals plot:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-38_fa91ddeaa82d3c2679bbbf15d2d91b82">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1">rs07 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb71-2">  <span class="fu" style="color: #4758AB;">augment</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb71-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> price,</span>
<span id="cb71-4">             <span class="at" style="color: #657422;">y =</span> .pred)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb71-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb71-6">  <span class="fu" style="color: #4758AB;">geom_abline</span>(<span class="at" style="color: #657422;">linetype =</span> <span class="st" style="color: #20794D;">"dashed"</span>,</span>
<span id="cb71-7">              <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb71-8">              <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.5</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>That’s pretty good! We do have one value that’s <strong><em>way</em></strong> off, so let’s see if regulization can help. This will require setting a new baseline model, and we’ll tune our way to the best regularizaion parameters.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-39_9233faaec3229487bf18f9f60160dbb7">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1">metrics <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb72-2">  rs07 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb72-3">  <span class="fu" style="color: #4758AB;">collect_metrics</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb72-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">model =</span> <span class="st" style="color: #20794D;">"model07"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb72-5">  <span class="fu" style="color: #4758AB;">bind_rows</span>(metrics)</span>
<span id="cb72-6"></span>
<span id="cb72-7"><span class="co" style="color: #5E5E5E;"># add normalization step</span></span>
<span id="cb72-8">rec08 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb72-9">  rec07 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb72-10">  <span class="fu" style="color: #4758AB;">step_zv</span>(<span class="fu" style="color: #4758AB;">all_numeric_predictors</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb72-11">  <span class="fu" style="color: #4758AB;">step_normalize</span>(<span class="fu" style="color: #4758AB;">all_numeric_predictors</span>(),</span>
<span id="cb72-12">                 <span class="sc" style="color: #5E5E5E;">-</span>cut_Ideal, <span class="sc" style="color: #5E5E5E;">-</span>cut_Premium, <span class="sc" style="color: #5E5E5E;">-</span>cut_Very.Good, <span class="sc" style="color: #5E5E5E;">-</span>cut_other,</span>
<span id="cb72-13">                 <span class="sc" style="color: #5E5E5E;">-</span>color_E, <span class="sc" style="color: #5E5E5E;">-</span>color_F, <span class="sc" style="color: #5E5E5E;">-</span>color_G, <span class="sc" style="color: #5E5E5E;">-</span>color_H, <span class="sc" style="color: #5E5E5E;">-</span>color_I, <span class="sc" style="color: #5E5E5E;">-</span>color_J,</span>
<span id="cb72-14">                 <span class="sc" style="color: #5E5E5E;">-</span>clarity_SI2, <span class="sc" style="color: #5E5E5E;">-</span>clarity_VS1, <span class="sc" style="color: #5E5E5E;">-</span>clarity_VS2, <span class="sc" style="color: #5E5E5E;">-</span>clarity_VVS1, <span class="sc" style="color: #5E5E5E;">-</span>clarity_VVS2, <span class="sc" style="color: #5E5E5E;">-</span>clarity_other)</span>
<span id="cb72-15"></span>
<span id="cb72-16"><span class="fu" style="color: #4758AB;">rm</span>(mod05, mod06, mod07, rec05, rec06, rec07, wf05, wf06, wf07, rs05, rs06, rs07)</span>
<span id="cb72-17"></span>
<span id="cb72-18">mod08 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb72-19">  <span class="fu" style="color: #4758AB;">linear_reg</span>(<span class="at" style="color: #657422;">penalty =</span> <span class="fu" style="color: #4758AB;">tune</span>(), <span class="at" style="color: #657422;">mixture =</span> <span class="fu" style="color: #4758AB;">tune</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb72-20">  <span class="fu" style="color: #4758AB;">set_engine</span>(<span class="st" style="color: #20794D;">"glmnet"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb72-21">  <span class="fu" style="color: #4758AB;">set_mode</span>(<span class="st" style="color: #20794D;">"regression"</span>) </span>
<span id="cb72-22"></span>
<span id="cb72-23">wf08 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb72-24">  <span class="fu" style="color: #4758AB;">workflow</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb72-25">  <span class="fu" style="color: #4758AB;">add_model</span>(mod08) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb72-26">  <span class="fu" style="color: #4758AB;">add_recipe</span>(rec08)</span>
<span id="cb72-27"></span>
<span id="cb72-28">diamonds_grid <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb72-29">  <span class="fu" style="color: #4758AB;">grid_regular</span>(<span class="fu" style="color: #4758AB;">penalty</span>(), <span class="fu" style="color: #4758AB;">mixture</span>(), <span class="at" style="color: #657422;">levels =</span> <span class="dv" style="color: #AD0000;">20</span>)</span>
<span id="cb72-30"></span>
<span id="cb72-31">doParallel<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">registerDoParallel</span>()</span>
<span id="cb72-32"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">5831</span>)</span>
<span id="cb72-33">rs08 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb72-34">  <span class="fu" style="color: #4758AB;">tune_grid</span>(</span>
<span id="cb72-35">    wf08,</span>
<span id="cb72-36">    <span class="at" style="color: #657422;">resamples =</span> diamonds_folds,</span>
<span id="cb72-37">    <span class="at" style="color: #657422;">control =</span> ctrl_preds,</span>
<span id="cb72-38">    <span class="at" style="color: #657422;">grid =</span> diamonds_grid</span>
<span id="cb72-39">  )</span></code></pre></div>
</details>
</div>
<p>Some notes but let’s explore our results…</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-40_c2f4e943324d9af635b9226396d50d3b">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1">rs08 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb73-2">  <span class="fu" style="color: #4758AB;">collect_metrics</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb73-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> penalty,</span>
<span id="cb73-4">             <span class="at" style="color: #657422;">y =</span> mean,</span>
<span id="cb73-5">             <span class="at" style="color: #657422;">color =</span> <span class="fu" style="color: #4758AB;">as.character</span>(mixture))) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb73-6">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb73-7">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.75</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb73-8">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span>.metric, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb73-9">  <span class="fu" style="color: #4758AB;">scale_x_log10</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>Looks like we were performing pretty well with the unregularized model, oddly enough! Let’s select the best and finalize our workflow.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-41_5058d4040c654b3f17622d8d873982bf">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1">best_metrics <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb74-2">  rs08 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb74-3">  <span class="fu" style="color: #4758AB;">select_best</span>(<span class="st" style="color: #20794D;">"rmse"</span>)</span>
<span id="cb74-4"></span>
<span id="cb74-5">wf_final <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb74-6">  <span class="fu" style="color: #4758AB;">finalize_workflow</span>(wf08, best_metrics)</span>
<span id="cb74-7"></span>
<span id="cb74-8"><span class="fu" style="color: #4758AB;">rm</span>(mod08, rec07, rec08, rs08, wf08)</span>
<span id="cb74-9"></span>
<span id="cb74-10"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">333</span>)</span>
<span id="cb74-11">final_fit <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb74-12">  wf_final <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb74-13">  <span class="fu" style="color: #4758AB;">fit</span>(diamonds_train)</span>
<span id="cb74-14"></span>
<span id="cb74-15">final_fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb74-16">  <span class="fu" style="color: #4758AB;">predict</span>(diamonds_test) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb74-17">  <span class="fu" style="color: #4758AB;">bind_cols</span>(diamonds_test) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb74-18">  <span class="fu" style="color: #4758AB;">select</span>(price, .pred) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb74-19">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> price, </span>
<span id="cb74-20">             <span class="at" style="color: #657422;">y =</span> .pred)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb74-21">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.05</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb74-22">  <span class="fu" style="color: #4758AB;">geom_abline</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb74-23">              <span class="at" style="color: #657422;">linetype =</span> <span class="st" style="color: #20794D;">"dashed"</span>,</span>
<span id="cb74-24">              <span class="at" style="color: #657422;">size =</span> <span class="fl" style="color: #AD0000;">0.5</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>What are the most important variables in this regularized model?</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-42_14f1335d215f8e8ca307faaf2053a43f">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1">final_fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb75-2">  <span class="fu" style="color: #4758AB;">pull_workflow_fit</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb75-3">  <span class="fu" style="color: #4758AB;">vi</span>(<span class="at" style="color: #657422;">lambda =</span> best_metrics<span class="sc" style="color: #5E5E5E;">$</span>penalty) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb75-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">Variable =</span> <span class="fu" style="color: #4758AB;">fct_reorder</span>(Variable, Importance)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb75-5">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> Variable,</span>
<span id="cb75-6">             <span class="at" style="color: #657422;">y =</span> Importance, </span>
<span id="cb75-7">             <span class="at" style="color: #657422;">fill =</span> Sign)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb75-8">  <span class="fu" style="color: #4758AB;">geom_col</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb75-9">  <span class="fu" style="color: #4758AB;">coord_flip</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>As expected, most of our terms get regularized away, which is what we want! Our chart is a little unreadable; let’s plot just the most important variables in a few ways:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-43_1c7be10a0132493837d50b131d7e343d">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1">final_fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb76-2">  <span class="fu" style="color: #4758AB;">pull_workflow_fit</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb76-3">  <span class="fu" style="color: #4758AB;">vi</span>(<span class="at" style="color: #657422;">lambda =</span> best_metrics<span class="sc" style="color: #5E5E5E;">$</span>penalty) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb76-4">  <span class="fu" style="color: #4758AB;">arrange</span>(<span class="fu" style="color: #4758AB;">desc</span>(Importance)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb76-5">  <span class="fu" style="color: #4758AB;">slice_head</span>(<span class="at" style="color: #657422;">n =</span> <span class="dv" style="color: #AD0000;">10</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb76-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">Variable =</span> <span class="fu" style="color: #4758AB;">fct_reorder</span>(Variable, Importance)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb76-7">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> Variable,</span>
<span id="cb76-8">             <span class="at" style="color: #657422;">y =</span> Importance,</span>
<span id="cb76-9">             <span class="at" style="color: #657422;">fill =</span> Sign)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb76-10">  <span class="fu" style="color: #4758AB;">geom_col</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb76-11">  <span class="fu" style="color: #4758AB;">coord_flip</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-44_d55547ea3ad3135d8112e5328ea203b4">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1">final_fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb77-2">  <span class="fu" style="color: #4758AB;">pull_workflow_fit</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb77-3">  <span class="fu" style="color: #4758AB;">vi</span>(<span class="at" style="color: #657422;">lambda =</span> best_metrics<span class="sc" style="color: #5E5E5E;">$</span>penalty) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb77-4">  <span class="fu" style="color: #4758AB;">arrange</span>(<span class="fu" style="color: #4758AB;">desc</span>(Importance)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb77-5">  <span class="fu" style="color: #4758AB;">slice_head</span>(<span class="at" style="color: #657422;">n =</span> <span class="dv" style="color: #AD0000;">10</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb77-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">Importance =</span> <span class="fu" style="color: #4758AB;">if_else</span>(Sign <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"NEG"</span>, <span class="sc" style="color: #5E5E5E;">-</span>Importance, Importance),</span>
<span id="cb77-7">         <span class="at" style="color: #657422;">Variable =</span> <span class="fu" style="color: #4758AB;">fct_reorder</span>(Variable, Importance)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb77-8">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> Variable,</span>
<span id="cb77-9">             <span class="at" style="color: #657422;">y =</span> Importance,</span>
<span id="cb77-10">             <span class="at" style="color: #657422;">fill =</span> Sign)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb77-11">  <span class="fu" style="color: #4758AB;">geom_col</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb77-12">  <span class="fu" style="color: #4758AB;">coord_flip</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>And look at that! Our most important variable was one that came from feature engineering! The size of the rock had the biggest impact on price.</p>
<p>We’ve gone through a lot of steps, so it may be good to look back on what was done:</p>
<ul>
<li>Explored our dataset via some simple exploratory data analysis;</li>
<li>Fit a simple linear model to predict the log-transform of price;</li>
<li>Attempted (and failed) to improve upon the simple model with fancier normalization and resampling techniques;</li>
<li>Explored the dataset further to find meaningful interactions and potential new features;</li>
<li>Fit a new model with feature engineering;</li>
<li>Tuned regularization parameters on our model with feature engineering to arrive at the final model.</li>
</ul>
<p>Our models’ performances, ranked from best to worst, show that the final tuned model did indeed perform the best on the test dataset!</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-45_4e128d973dcd62a33d1d17a5f69370d3">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1">final_preds <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb78-2">  final_fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-3">  <span class="fu" style="color: #4758AB;">predict</span>(diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-4">  <span class="fu" style="color: #4758AB;">bind_cols</span>(diamonds_train) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-5">  <span class="fu" style="color: #4758AB;">select</span>(price, .pred)</span>
<span id="cb78-6"></span>
<span id="cb78-7"><span class="fu" style="color: #4758AB;">bind_rows</span>(final_preds <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">rmse</span>(price, .pred),</span>
<span id="cb78-8">          final_preds <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">rsq</span>(price, .pred)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-9">  <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #657422;">mean =</span> .estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-10">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>.estimator) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-11">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">model =</span> <span class="st" style="color: #20794D;">"model_final"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-12">  <span class="fu" style="color: #4758AB;">bind_rows</span>(metrics <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">select</span>(.metric, mean, model)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-13">  <span class="fu" style="color: #4758AB;">pivot_wider</span>(<span class="at" style="color: #657422;">names_from =</span> .metric,</span>
<span id="cb78-14">              <span class="at" style="color: #657422;">values_from =</span> mean) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-15">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">model =</span> <span class="fu" style="color: #4758AB;">fct_reorder</span>(model, <span class="fu" style="color: #4758AB;">desc</span>(rmse))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-16">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(rmse<span class="sc" style="color: #5E5E5E;">:</span>rsq,</span>
<span id="cb78-17">               <span class="at" style="color: #657422;">names_to =</span> <span class="st" style="color: #20794D;">"metric"</span>,</span>
<span id="cb78-18">               <span class="at" style="color: #657422;">values_to =</span> <span class="st" style="color: #20794D;">"value"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb78-19">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> model,</span>
<span id="cb78-20">             <span class="at" style="color: #657422;">y =</span> value)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb78-21">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb78-22">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span>metric, <span class="at" style="color: #657422;">scales =</span> <span class="st" style="color: #20794D;">"free"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb78-23">  <span class="fu" style="color: #4758AB;">coord_flip</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="2100"></p>
</div>
</div>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Diamonds Are {Forever}},
  date = {2021-11-14},
  url = {https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Diamonds Are Forever.”</span> November 14,
2021. <a href="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset">https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset</a>.
</div></div></section></div> ]]></description>
  <category>tidymodels</category>
  <guid>https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/index.html</guid>
  <pubDate>Sun, 14 Nov 2021 06:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-11-14-diamonds-are-forever-feature-engineering-with-the-diamonds-dataset/featured.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Election Night: Some Closing Thoughts on the VA Governor Race</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-11-02-election-night-some-closing-thoughts-on-the-va-governor-race/index.html</link>
  <description><![CDATA[ 




<p>A few weeks ago I had <a href="https://www.thedatadiary.net/blog/2021-10-19-polling-average-of-the-va-governor-s-race-using-purrr-map-functions/">written about the VA Governor’s race</a> before going on vacation - in that time it seems as though Terry McAuliffe’s campaign had lost a lot of steam and Youngkin made up a lot of ground in the final weeks of the campaign. At the time of this writing, it seems overwhelmingly likely that Glenn Youngkin will become the next governor of Virginia. To avoid some of the <a href="https://twitter.com/rp_griffin/status/1455696452915802122">galaxy-brain takes that will inevitabely wind up twitter</a>, I thought I’d distract myself by following up on my previous post.</p>
<p>Firstly, I should share the updated polling average. A few weeks ago, McAullife appeared to have a sizeable lead in the polls:</p>
<p></p><div id="tweet-71410"></div><script>tweet={"url":"https:\/\/twitter.com\/markjrieke\/status\/1444454926399254535","author_name":"Mark Rieke","author_url":"https:\/\/twitter.com\/markjrieke","html":"\u003Cblockquote class=\"twitter-tweet\" align=\"center\"\u003E\u003Cp lang=\"en\" dir=\"ltr\"\u003EFiveThirtyEight&#39;s poll tracker for the VA governor race (\u003Ca href=\"https:\/\/t.co\/HKVw7RcsJN\"\u003Ehttps:\/\/t.co\/HKVw7RcsJN\u003C\/a\u003E) shows the moving averages - as a weekend coding project, I revamped with a weighted avg., 95% CI, and win probability based on an election day distribution\uD83D\uDCC8 \u003Ca href=\"https:\/\/t.co\/hM6vzLUZnM\"\u003Epic.twitter.com\/hM6vzLUZnM\u003C\/a\u003E\u003C\/p\u003E&mdash; Mark Rieke (@markjrieke) \u003Ca href=\"https:\/\/twitter.com\/markjrieke\/status\/1444454926399254535?ref_src=twsrc%5Etfw\"\u003EOctober 3, 2021\u003C\/a\u003E\u003C\/blockquote\u003E\n\u003Cscript async src=\"https:\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"\u003E\u003C\/script\u003E\n","width":550,"height":null,"type":"rich","cache_age":"3153600000","provider_name":"Twitter","provider_url":"https:\/\/twitter.com","version":"1.0"};document.getElementById("tweet-71410").innerHTML = tweet["html"];</script><p></p>
<p>However, as of election day, the race had significantly tightened to effectively a coin-toss:</p>
<p></p><div id="tweet-94848"></div><script>tweet={"url":"https:\/\/twitter.com\/markjrieke\/status\/1455164731749175304","author_name":"Mark Rieke","author_url":"https:\/\/twitter.com\/markjrieke","html":"\u003Cblockquote class=\"twitter-tweet\" align=\"center\"\u003E\u003Cp lang=\"en\" dir=\"ltr\"\u003EFinal update - p_win ~ 55% McAuliffe; again, the win probability is just the portion of the polling avg. distribution above 50% for each candidate. For *actual* models, go check out the work by \u003Ca href=\"https:\/\/twitter.com\/lxeagle17?ref_src=twsrc%5Etfw\"\u003E@lxeagle17\u003C\/a\u003E\/\u003Ca href=\"https:\/\/twitter.com\/Thorongil16?ref_src=twsrc%5Etfw\"\u003E@Thorongil16\u003C\/a\u003E or \u003Ca href=\"https:\/\/twitter.com\/jhkersting?ref_src=twsrc%5Etfw\"\u003E@jhkersting\u003C\/a\u003E, among others \u003Ca href=\"https:\/\/t.co\/W9bDf1OumZ\"\u003Epic.twitter.com\/W9bDf1OumZ\u003C\/a\u003E\u003C\/p\u003E&mdash; Mark Rieke (@markjrieke) \u003Ca href=\"https:\/\/twitter.com\/markjrieke\/status\/1455164731749175304?ref_src=twsrc%5Etfw\"\u003ENovember 1, 2021\u003C\/a\u003E\u003C\/blockquote\u003E\n\u003Cscript async src=\"https:\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"\u003E\u003C\/script\u003E\n","width":550,"height":null,"type":"rich","cache_age":"3153600000","provider_name":"Twitter","provider_url":"https:\/\/twitter.com","version":"1.0"};document.getElementById("tweet-94848").innerHTML = tweet["html"];</script><p></p>
<p>As I mention in the above tweet, the win probability isn’t a true forecast, just the portion of each candidate’s election day distribution <em>above 50%</em>. That being said, actual forecasts similarly had the race down to a near 50-50 split as of this morning:</p>
<p></p><div id="tweet-31853"></div><script>tweet={"url":"https:\/\/twitter.com\/gelliottmorris\/status\/1454130028149620737","author_name":"G. Elliott Morris","author_url":"https:\/\/twitter.com\/gelliottmorris","html":"\u003Cblockquote class=\"twitter-tweet\" align=\"center\"\u003E\u003Cp lang=\"en\" dir=\"ltr\"\u003ESpecial for Twitter: Updated VA polling trends with the new Fox and Post\/GMU polls \u003Ca href=\"https:\/\/t.co\/hLNa3pFCpR\"\u003Ehttps:\/\/t.co\/hLNa3pFCpR\u003C\/a\u003E \u003Ca href=\"https:\/\/t.co\/6cz0JXa0xm\"\u003Epic.twitter.com\/6cz0JXa0xm\u003C\/a\u003E\u003C\/p\u003E&mdash; G. Elliott Morris (@gelliottmorris) \u003Ca href=\"https:\/\/twitter.com\/gelliottmorris\/status\/1454130028149620737?ref_src=twsrc%5Etfw\"\u003EOctober 29, 2021\u003C\/a\u003E\u003C\/blockquote\u003E\n\u003Cscript async src=\"https:\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"\u003E\u003C\/script\u003E\n","width":550,"height":null,"type":"rich","cache_age":"3153600000","provider_name":"Twitter","provider_url":"https:\/\/twitter.com","version":"1.0"};document.getElementById("tweet-31853").innerHTML = tweet["html"];</script><p></p>
<p></p><div id="tweet-71947"></div><script>tweet={"url":"https:\/\/twitter.com\/jhkersting\/status\/1455545666999042056","author_name":"Jack Kersting","author_url":"https:\/\/twitter.com\/jhkersting","html":"\u003Cblockquote class=\"twitter-tweet\" align=\"center\"\u003E\u003Cp lang=\"en\" dir=\"ltr\"\u003E\u003Ca href=\"https:\/\/twitter.com\/hashtag\/FINAL?src=hash&amp;ref_src=twsrc%5Etfw\"\u003E#FINAL\u003C\/a\u003E Virginia Gov. Projection.\u003Ca href=\"https:\/\/twitter.com\/GlennYoungkin?ref_src=twsrc%5Etfw\"\u003E@GlennYoungkin\u003C\/a\u003E is ever so slightly favored in this tossup for the governorship.\u003Cbr\u003E\u003Cbr\u003EFull Projection&gt;&gt;\u003Ca href=\"https:\/\/t.co\/PcM2qSjUYK\"\u003Ehttps:\/\/t.co\/PcM2qSjUYK\u003C\/a\u003E \u003Ca href=\"https:\/\/t.co\/NGCirjkkG4\"\u003Epic.twitter.com\/NGCirjkkG4\u003C\/a\u003E\u003C\/p\u003E&mdash; Jack Kersting (@jhkersting) \u003Ca href=\"https:\/\/twitter.com\/jhkersting\/status\/1455545666999042056?ref_src=twsrc%5Etfw\"\u003ENovember 2, 2021\u003C\/a\u003E\u003C\/blockquote\u003E\n\u003Cscript async src=\"https:\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"\u003E\u003C\/script\u003E\n","width":550,"height":null,"type":"rich","cache_age":"3153600000","provider_name":"Twitter","provider_url":"https:\/\/twitter.com","version":"1.0"};document.getElementById("tweet-71947").innerHTML = tweet["html"];</script><p></p>
<p>Even the model most confident in McAuliffe built by <a href="https://twitter.com/lxeagle17">Lakshya Jain</a> and <a href="https://twitter.com/Thorongil16">Thorongil</a> had dropped McAuliffe’s win probability from ~85% to 67% over the course of a few weeks:</p>
<p></p><div id="tweet-48750"></div><script>tweet={"url":"https:\/\/twitter.com\/lxeagle17\/status\/1455544487149592576","author_name":"Lakshya Jain","author_url":"https:\/\/twitter.com\/lxeagle17","html":"\u003Cblockquote class=\"twitter-tweet\" align=\"center\"\u003E\u003Cp lang=\"en\" dir=\"ltr\"\u003E\uD83D\uDEA8FINAL \u003Ca href=\"https:\/\/twitter.com\/hashtag\/VAGov?src=hash&amp;ref_src=twsrc%5Etfw\"\u003E#VAGov\u003C\/a\u003E FORECAST\uD83D\uDEA8\u003Cbr\u003E\u003Cbr\u003EAt the end of a long campaign, here&#39;s where the model made by me and \u003Ca href=\"https:\/\/twitter.com\/Thorongil16?ref_src=twsrc%5Etfw\"\u003E@Thorongil16\u003C\/a\u003E stands. The race is rated as Lean Democratic, with a forecasted margin of D+3.6 and a win probability of 67%. An interactive map is over at \u003Ca href=\"https:\/\/t.co\/Kmvj6sRElC\"\u003Ehttps:\/\/t.co\/Kmvj6sRElC\u003C\/a\u003E. \u003Ca href=\"https:\/\/t.co\/kuaJc82HML\"\u003Epic.twitter.com\/kuaJc82HML\u003C\/a\u003E\u003C\/p\u003E&mdash; Lakshya Jain (@lxeagle17) \u003Ca href=\"https:\/\/twitter.com\/lxeagle17\/status\/1455544487149592576?ref_src=twsrc%5Etfw\"\u003ENovember 2, 2021\u003C\/a\u003E\u003C\/blockquote\u003E\n\u003Cscript async src=\"https:\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"\u003E\u003C\/script\u003E\n","width":550,"height":null,"type":"rich","cache_age":"3153600000","provider_name":"Twitter","provider_url":"https:\/\/twitter.com","version":"1.0"};document.getElementById("tweet-48750").innerHTML = tweet["html"];</script><p></p>
<p>While I definitely plan on utilizing a more scientific poll-weighting methodology in the future, I do find it interesting that even a simple averaging method can produce relatively accurate results in line with the majority of other forecasters.</p>
<p>Regarding post-hoc analysis of <em>why</em> McAuliffe lost, I won’t dredge up any of my own (partially because it’d be irresponsible &amp; pundit-y to do so without referencing any data and partially because it’s getting late &amp; I’m a bit tired), but I’ll point out a few tweets from <a href="https://twitter.com/Nate_Cohn">Nate Cohn</a> that show that the results appear to show a near uniform shift across precincts and different voting groups. This would suggest that McAuliffe’s loss is tied more closely to the national environment, rather than shifts amongst specific groups/counties.</p>
<p></p><div id="tweet-29014"></div><script>tweet={"url":"https:\/\/twitter.com\/Nate_Cohn\/status\/1455693099062153217","author_name":"Nate Cohn","author_url":"https:\/\/twitter.com\/Nate_Cohn","html":"\u003Cblockquote class=\"twitter-tweet\" align=\"center\"\u003E\u003Cp lang=\"en\" dir=\"ltr\"\u003EUpdate at nearly 1500 precincts: Youngkin is still on track for victory, running a ahead of what he needs across basically every dimension worth looking at.\u003Cbr\u003EBut it&#39;s worth noting just how close things are to &#39;expectations,&#39; which is simply shifting the 2020 result to the right \u003Ca href=\"https:\/\/t.co\/Mbe3pg7NFB\"\u003Epic.twitter.com\/Mbe3pg7NFB\u003C\/a\u003E\u003C\/p\u003E&mdash; Nate Cohn (@Nate_Cohn) \u003Ca href=\"https:\/\/twitter.com\/Nate_Cohn\/status\/1455693099062153217?ref_src=twsrc%5Etfw\"\u003ENovember 3, 2021\u003C\/a\u003E\u003C\/blockquote\u003E\n\u003Cscript async src=\"https:\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"\u003E\u003C\/script\u003E\n","width":550,"height":null,"type":"rich","cache_age":"3153600000","provider_name":"Twitter","provider_url":"https:\/\/twitter.com","version":"1.0"};document.getElementById("tweet-29014").innerHTML = tweet["html"];</script><p></p>
<p></p><div id="tweet-34022"></div><script>tweet={"url":"https:\/\/twitter.com\/Nate_Cohn\/status\/1455717564772986884","author_name":"Nate Cohn","author_url":"https:\/\/twitter.com\/Nate_Cohn","html":"\u003Cblockquote class=\"twitter-tweet\" align=\"center\"\u003E\u003Cp lang=\"en\" dir=\"ltr\"\u003EAnd btw, if you&#39;re doing pundit things I&#39;d look at that red column. McAuliffe fell short of expectations--a more-or-less uniform shift--by basically the same amount, just about everywhere\u003C\/p\u003E&mdash; Nate Cohn (@Nate_Cohn) \u003Ca href=\"https:\/\/twitter.com\/Nate_Cohn\/status\/1455717564772986884?ref_src=twsrc%5Etfw\"\u003ENovember 3, 2021\u003C\/a\u003E\u003C\/blockquote\u003E\n\u003Cscript async src=\"https:\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"\u003E\u003C\/script\u003E\n","width":550,"height":null,"type":"rich","cache_age":"3153600000","provider_name":"Twitter","provider_url":"https:\/\/twitter.com","version":"1.0"};document.getElementById("tweet-34022").innerHTML = tweet["html"];</script><p></p>
<p>This won’t stop the networks from ascribing the win/loss to very specific campaign issues (I’ve already seen quite a few folks ascribe Youngkin’s win to education, race, suburban-reversion, etc., without any evidence to back up such claims). Until there are deep dives into data regarding the election, I’d treat any comments from pundits with a hefty grain of salt.</p>
<section id="some-closing-thoughts" class="level3">
<h3 class="anchored" data-anchor-id="some-closing-thoughts">Some closing thoughts</h3>
<p>That’s all for me today! I’ll be back in a few weeks with some non-political content, looking at a machine learning model predicting the price of a diamond in the <a href="https://ggplot2.tidyverse.org/reference/diamonds.html">diamonds dataset</a>.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Election {Night:} {Some} {Closing} {Thoughts} on the {VA}
    {Governor} {Race}},
  date = {2021-11-02},
  url = {https://www.thedatadiary.net/posts/2021-11-02-election-night-some-closing-thoughts-on-the-va-governor-race},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Election Night: Some Closing Thoughts on the VA
Governor Race.”</span> November 2, 2021. <a href="https://www.thedatadiary.net/posts/2021-11-02-election-night-some-closing-thoughts-on-the-va-governor-race">https://www.thedatadiary.net/posts/2021-11-02-election-night-some-closing-thoughts-on-the-va-governor-race</a>.
</div></div></section></div> ]]></description>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-11-02-election-night-some-closing-thoughts-on-the-va-governor-race/index.html</guid>
  <pubDate>Tue, 02 Nov 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-11-02-election-night-some-closing-thoughts-on-the-va-governor-race/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Polling Average of the VA Governor’s Race using purrr::map functions</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-10-19-polling-average-of-the-va-governor-s-race-using-purrr-map-functions/index.html</link>
  <description><![CDATA[ 




<p>Rolling poll averages can be misleading in the absence of errorbars or an expected distribution of outcomes. FiveThirtyEight is currently <a href="https://projects.fivethirtyeight.com/polls/governor/virginia/">tracking polls of Virginia’s Governor race</a> slated for early November, and has kindly made their polls <a href="https://projects.fivethirtyeight.com/polls-page/data/governor_polls.csv">available to the public</a>. Their current polling average, however, looks to be a simple rolling average and doesn’t include a confidence interval. I’ve attempted to improve upon their tracker here by providing a weighted polling average and a 95% confidence interval.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-10-19-polling-average-of-the-va-governor-s-race-using-purrr-map-functions/pics/race_results_2021-10-19.png" class="img-fluid"></p>
<section id="how-this-works" class="level1">
<h1>How this works</h1>
<p>Since we’re only considering the top candidates from each party, we’ll look at each candidate’s two-party voteshare of each poll. To get the two-party voteshare, third party or other minor candidates are removed from each poll and each candidate’s percentage is recalculated as if they were the only two options on the ballot (in practice, this only removes a tiny amount of undecideds and third party voters). Then, the daily polling average is calculated by weighting each poll by sample size and recency. Using <a href="https://en.wikipedia.org/wiki/Bayes%27_theorem">Bayes’ theorem</a> and a weak <a href="https://en.wikipedia.org/wiki/Continuous_uniform_distribution">uniform prior</a>, we can use the same method recalculate the polling average and confidence interval for each day between today and the election. Because polls are weighted by recency, as we look further and further into the future, our confidence in the polls decreases and the confidence interval around the polling average fans out. Each candidate’s probability of winning is the portion of the portion of the projected election-day polling distribution in their favor, based on that day’s polling average.</p>
</section>
<section id="some-caveats-worth-noting" class="level1">
<h1>Some caveats worth noting</h1>
<p>This is an inherently flawed method, and it’s worth pointing out a few of the flaws and shortcuts I used:</p>
<section id="the-functions-used-to-weight-polls-are-nowhere-near-perfect." class="level3">
<h3 class="anchored" data-anchor-id="the-functions-used-to-weight-polls-are-nowhere-near-perfect.">The functions used to weight polls are nowhere near perfect.</h3>
<p>The original weighting functions (which I haven’t changed) were chosen somewhat arbitrarily. In hindsight, they’re probably placing too much emphasis on recency and the error bars ought to be larger. While I have received some <a href="https://community.rstudio.com/t/is-it-possible-to-tune-arbitrary-parameters-w-tidymodels/117998/2">advice on tuning arbitrary functions</a> as a part of a larger model, I haven’t implemented here. It’s more prudent to think of this as an over-confident polling aggregate, rather than any sort of model. For a true projection model, I’d recommend looking at <a href="https://projects.jhkforecasts.com/2022-midterms/virginia-governor">Jack Kersting’s website</a>.</p>
</section>
<section id="the-weighting-method-ignores-important-weighting-factors" class="level3">
<h3 class="anchored" data-anchor-id="the-weighting-method-ignores-important-weighting-factors">The weighting method ignores important weighting factors</h3>
<p>This weighting method is super simple and ignores common weighting factors, like pollster and survey methodology. Other less-common poll weighting methods, like accounting for partisan non-response bias and and how the pollster weights their results (notably, whether or not the pollster weights by education) were similarly ignored. There is definitely a <a href="https://gelliottmorris.substack.com/p/what-people-are-missing-about-the?justPublished=true">strong argument</a> for including these weighting factors, but for me, this exercise was more about learning to use <code>purrr::map()</code> and other related functions when <a href="https://github.com/markjrieke/thedatadiary/blob/main/2021.10.01-virginia_governors_race/scripts/va_poll_wrangle.R">writing the script for this plot</a>.</p>
</section>
<section id="some-pollsters-are-filtered-out-by-design" class="level3">
<h3 class="anchored" data-anchor-id="some-pollsters-are-filtered-out-by-design">Some pollsters are filtered out by design</h3>
<p>I debated this for quite some time, but decided to add a filter to remove polls conducted by <a href="https://www.rasmussenreports.com/">Rasmussen</a> and <a href="https://www.thetrafalgargroup.org/">Trafalgar</a>. Trafalgar is excluded from any of the <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ56fySJKLL18Lipu1_i3ID9JE06voJEz2EXm6JW4Vh11zmndyTwejMavuNntzIWLY0RyhA1UsVEen0/pub?gid=0&amp;single=true&amp;output=csv">Economist’s polling databases</a> for opaque yet clearly shoddy methodology and Rasmussen is <a href="https://twitter.com/Rasmussen_Poll/status/1448819612242616324?ref_src=twsrc%5Etfw%7Ctwcamp%5Eembeddedtimeline%7Ctwterm%5Eprofile%3ARasmussen_Poll%7Ctwgr%5EeyJ0ZndfZXhwZXJpbWVudHNfY29va2llX2V4cGlyYXRpb24iOnsiYnVja2V0IjoxMjA5NjAwLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X2hvcml6b25fdHdlZXRfZW1iZWRfOTU1NSI6eyJidWNrZXQiOiJodGUiLCJ2ZXJzaW9uIjpudWxsfSwidGZ3X3NwYWNlX2NhcmQiOnsiYnVja2V0Ijoib2ZmIiwidmVyc2lvbiI6bnVsbH19%7Ctwcon%5Etimelinechrome&amp;ref_url=https%3A%2F%2Fwww.rasmussenreports.com%2F">clearly partisan</a>. Removing these from the average follows the general consensus on ET (though, to be transparent, ET does tend to slant far to the left). In future polling projects, I’d hope to develop some more robust methodology to programatically downweight problematic pollsters (how’s <em>that</em> for a tongue twister?), but for now I’m just going to exclude.</p>
</section>
</section>
<section id="final-thoughts-on-polling" class="level1">
<h1>Final thoughts on polling</h1>
<p>This methodology certainly has its flaws, but it <em>is</em> <a href="https://github.com/markjrieke/thedatadiary/blob/main/2021.10.01-virginia_governors_race/scripts/va_poll_wrangle.R">transparent</a>. I’ll continuously update this plot up until election day on my <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.10.01-virginia_governors_race">github</a>.</p>
</section>
<section id="some-programming-notes" class="level1">
<h1>Some programming notes</h1>
<p>I’ve finished migrating my site to Netlify! I had originally planned to make the switch from Squarespace sometime early in 2022, but motivation struck me during a relatively light work week and I was able to rebuild the site using <a href="https://bookdown.org/yihui/blogdown/">blogdown</a>. This allows for a lot more customization and control than was available with Squarespace, but the biggest upside is <em>definitely</em> the ease of sharing in-line code, here’s a quick example:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;"># let's put together a plot from the diamonds dataset</span></span>
<span id="cb1-4">diamonds <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-5">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> carat,</span>
<span id="cb1-6">             <span class="at" style="color: #657422;">y =</span> price,</span>
<span id="cb1-7">             <span class="at" style="color: #657422;">color =</span> cut)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-9">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-10">  viridis<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">scale_color_viridis</span>(<span class="at" style="color: #657422;">discrete =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://www.thedatadiary.net/posts/2021-10-19-polling-average-of-the-va-governor-s-race-using-purrr-map-functions/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>This ease of use and visibility will make things more seamless for me and allow me to dig into more technical content in more detail in the future!</p>
<p>I’ll be taking a (much needed) vacation next week, spending some time off the grid in the Grand Canyon and surrounding area with my family. I’ve got a short post lined up for early November when I return - see you then!</p>
<p>As always, you can find the source files for <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.10.01-virginia_governors_race">the script to generate the polling average</a> and for <a href="https://github.com/markjrieke/thedatadiary.net">this site</a> on my github.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Polling {Average} of the {VA} {Governor’s} {Race} Using
    Purrr::map Functions},
  date = {2021-10-19},
  url = {https://www.thedatadiary.net/posts/2021-10-19-polling-average-of-the-va-governor-s-race-using-purrr-map-functions},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Polling Average of the VA Governor’s Race Using
Purrr::map Functions.”</span> October 19, 2021. <a href="https://www.thedatadiary.net/posts/2021-10-19-polling-average-of-the-va-governor-s-race-using-purrr-map-functions">https://www.thedatadiary.net/posts/2021-10-19-polling-average-of-the-va-governor-s-race-using-purrr-map-functions</a>.
</div></div></section></div> ]]></description>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-10-19-polling-average-of-the-va-governor-s-race-using-purrr-map-functions/index.html</guid>
  <pubDate>Tue, 19 Oct 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-10-19-polling-average-of-the-va-governor-s-race-using-purrr-map-functions/featured.png" medium="image" type="image/png" height="192" width="144"/>
</item>
<item>
  <title>RStudio’s Call for Documentation</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-10-05-rstudio-s-call-for-documentation/index.html</link>
  <description><![CDATA[ 




<p>In my job, I spend a good amount of time working in the platform setup by our survey vendor, <a href="https://www.qualtrics.com/">Qualtrics</a>. There are some pre-formatted reports that we can send on a recurring basis through Qualtrics, but for one-off or custom reports, I can work with the raw data in R. A few weeks ago, however, I was asked to setup a recurring email to send a customized report to a group of hospital directors each week. While R makes generating the report simple, sending out each week was tedious, as each one needed to be sent separately. Since the reports contain patient information, I couldn’t automate via a third party server like <a href="https://github.com/features/actions">GitHub Actions</a>. I needed a way to localize the automation to my computer.</p>
<p>Luckily enough, I was able to work out a solution! I wrote about it in a submission to <a href="https://community.rstudio.com/t/r-views-call-for-documentation-announcement/110579">RStudio’s 2021 Call for Documentation</a>. You can read my article on <a href="https://community.rstudio.com/t/automated-email-reports-with-r-vba-and-the-task-scheduler-r-views-submission/115807/5">Automated Email Reports with R, VBA, and the Task Scheduler</a> for more detail.</p>
<section id="some-programming-notes" class="level3">
<h3 class="anchored" data-anchor-id="some-programming-notes">Some programming notes</h3>
<ul>
<li>I’ve been named one of RStudio Community’s New Users of the Month!</li>
<li>I’ve started working in Rmarkdown for these posts (you can actually view the native file for this post here). This allows me to mix in code and prose in one document &amp; should make the process a bit easier on my end.</li>
<li>I’ve scheduled out posts every two weeks for the rest of the year. I wanted to give myself enough time to work on some longer term projects, so be on the lookout for more in store!</li>
</ul>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {RStudio’s {Call} for {Documentation}},
  date = {2021-10-05},
  url = {https://www.thedatadiary.net/posts/2021-10-05-rstudio-s-call-for-documentation},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“RStudio’s Call for Documentation.”</span>
October 5, 2021. <a href="https://www.thedatadiary.net/posts/2021-10-05-rstudio-s-call-for-documentation">https://www.thedatadiary.net/posts/2021-10-05-rstudio-s-call-for-documentation</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>rstats</category>
  <guid>https://www.thedatadiary.net/posts/2021-10-05-rstudio-s-call-for-documentation/index.html</guid>
  <pubDate>Tue, 05 Oct 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-10-05-rstudio-s-call-for-documentation/icon.png" medium="image" type="image/png" height="132" width="144"/>
</item>
<item>
  <title>Catching Up (again)</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-09-23-catching-up-again/index.html</link>
  <description><![CDATA[ 




<p>Wow, it’s been quite a while! Once again, I’m catching up from a long hiatus (this time, there was about a month’s gap between posts). Although I haven’t been writing here, I have been keeping myself incredibly busy - for that reason, I think I’m going to switch up the format of this site. Here’s a few changes I’m planning on making, &amp; also why I plan on making them.</p>
<section id="opening-up-topic-options" class="level3">
<h3 class="anchored" data-anchor-id="opening-up-topic-options">Opening up topic options</h3>
<p>Up until now, I’ve pretty much exclusively been looking at politically-related things from a data-centric point of view, partially because most news outlets are sensationalist and it annoys me, and partially because the 2020 election &amp; aftermath was on my mind for most of early 2021 (also, wanting to understand the <a href="https://projects.economist.com/us-2020-forecast/president/how-this-works">Economist’s Election Forecast methodology</a> was the spark that led to taking stats classes, learning R, and [eventually] landing a new job). While I still want to/expect that I will touch on political-esque topics, I want to expand into things I’m more generally interested in. I’ve spent a lot of time this year working on projects that don’t touch politics and it was difficult to spur the enthusiasm to work on a political project just to fill the site after having spent hours coding something unrelated. I’ve imposed this political filter on myself, &amp; expanding the horizon to include any/all topics that interest me will allow me to more consistently write without overextending myself.</p>
</section>
<section id="moving-away-from-squarespace" class="level3">
<h3 class="anchored" data-anchor-id="moving-away-from-squarespace">Moving away from Squarespace</h3>
<p>Currently, this site is hosted by Squarespace. This was great for getting setup &amp; used to working online, but after a year of working with it, I’ve realized that it isn’t the ideal platform for my use case. Early next year, hopefully, I’ll switch over to using rmarkdown, Hugo, and Netifly to build &amp; deploy a site directly from R. This will make my life a lot easier, for a couple of reasons:</p>
<ul>
<li>I will have a lot more control over layouts and themes</li>
<li>I’ll be able to more easily share code, images, and interactives(!)</li>
<li>The code &amp; the website will be housed under one directory (rather than existing as two separate entities)</li>
</ul>
<p>Additionally, the platform I’m planning on moving to is more blog/personal-professional focused, rather than retail focused, like Squarespace. I may also be able to move towards having posts appear in emails, rather than having to link to the post itself.</p>
</section>
<section id="timeline" class="level3">
<h3 class="anchored" data-anchor-id="timeline">Timeline</h3>
<p>I haven’t yet settled on this yet, but I may move from a weekly schedule to a bi-weekly schedule (not that I ever really stuck to the weekly schedule). The projects I’ve been working on typically take quite a bit of time, so trying to churn one out each week means that I may have to suffer quality for a schedule, which I don’t want to do. I’d rather have enough time to fully devote to completing something.</p>
<p>Anyways, that’s a lot of updates - I’ll hopefully check in within a few weeks time!</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Catching {Up} (Again)},
  date = {2021-09-23},
  url = {https://www.thedatadiary.net/posts/2021-09-23-catching-up-again},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Catching Up (Again).”</span> September 23,
2021. <a href="https://www.thedatadiary.net/posts/2021-09-23-catching-up-again">https://www.thedatadiary.net/posts/2021-09-23-catching-up-again</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <guid>https://www.thedatadiary.net/posts/2021-09-23-catching-up-again/index.html</guid>
  <pubDate>Thu, 23 Sep 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-09-23-catching-up-again/icon.png" medium="image" type="image/png" height="132" width="144"/>
</item>
<item>
  <title>Tidymodels and the Titanic</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/index.html</link>
  <description><![CDATA[ 




<p>This week, I thought I’d do something a bit different. I’ve been working with &amp; getting used to <a href="https://www.tidymodels.org/">tidymodels</a>, a suite of R packages for building machine learning models with tidyverse principles (you can thank <a href="https://juliasilge.com/blog/">Julia Silge’s blog</a> for providing a whole host of examples and walkthroughs). Using tidymodels and <a href="https://www.kaggle.com/c/titanic">Kaggle’s Titanic dataset</a>, I created a few simple models to predict whether or not each passenger survived.</p>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<p>First off, it’s important to get to know the dataset in a bit of detail before diving into model building. The Titanic dataset is relatively small, containing 12 columns of data on 891 passengers.</p>
<ul>
<li><strong>PassengerId</strong> : ordered number assigned to each passenger (1, 2, 3… etc.).</li>
<li><strong>Survived</strong> : indicates whether the passenger survived or not (imported as numeric, where a 1 means that the passenger survived and a 0 means that the passenger died.</li>
<li><strong>PClass</strong> : passenger class (1st, 2nd, or 3rd).</li>
<li><strong>Name</strong> : passenger’s name.</li>
<li><strong>Sex</strong> : passenger’s sex.</li>
<li><strong>Age</strong> : passenger’s age.</li>
<li><strong>SibSp</strong> : number of the passenger’s siblings and/or spouses aboard the ship.</li>
<li><strong>Parch</strong> : number of the passenger’s parents and/or children aboard the ship.</li>
<li><strong>Ticket</strong> : passenger’s ticket number.</li>
<li><strong>Fare</strong> : price of the passenger’s ticket.</li>
<li><strong>Cabin</strong> : passenger’s cabin number.</li>
<li><strong>Embarked</strong> : port from which the passenger embarked.</li>
</ul>
<p>The passenger’s name and ticket number are unique, and don’t offer any much predictive power (at least, not for the type we’ll be deploying), so I’ve removed those columns from the selection. The majority of passengers are missing Cabin information, so I’ve similarly removed that column. Let’s take a look at the age distribution by gender. Density plots are good for this sort of objective, but a quick note - density plots don’t show the counts (like a histogram), just the relative distribution of each group.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/pics/plot_01.png" class="img-fluid"></p>
<p>Both men and women have similar age distributions, with the majority being adults roughly in their twenties. It’d be interesting to look at which age groups survived.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/pics/plot_02.png" class="img-fluid"></p>
<p>There’s a spike survivorship at a young age (as expected, due to the prioritization of children). Young adults make up the majority of both survivors and those who died, simply because young adults made up the majority of passengers. It may be more interesting to see which male/female age groups survived.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/pics/plot_03.png" class="img-fluid"></p>
<p>Interestingly, there’s a large portion of the women who died were children. To gain some more insight, however, it may be beneficial to bin the results. As mentioned above, density plots don’t show a count of each age, but the relative amounts instead. We can use a histogram to get a better idea of the actual amount in each group.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/pics/plot_04.png" class="img-fluid"></p>
<p>From the histogram, we can see that there were far more male passengers than female passengers. Let’s setup age brackets and see how many of each age group survived.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/pics/plot_05.png" class="img-fluid"></p>
<p>Despite there being more male passengers, there were more female survivors in just about every age bracket. I had expected that women would have a greater percentage of survivorship, but was mildly surprised that the absolute number of female survivors was greater than the number of male survivors.</p>
<p>Lets look at how survivorship is related to the number of family members each passenger was traveling with.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/pics/plot_06.png" class="img-fluid"></p>
<p>While there’s not huge variation between survivorship percentages across each class, we can see that the majority of passengers were traveling alone.</p>
<p>Finally, I looked at the distribution of the fare price by survivorship. As expected, passengers who didn’t survive skewed towards low cost fares while survivors were more evenly distributed across fare prices.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/pics/plot_07.png" class="img-fluid"></p>
</section>
<section id="model-fitting-and-evaluation" class="level1">
<h1>Model Fitting and Evaluation</h1>
<p>Now that we’ve explored the data a bit, we can get started on some actual model fitting and evaluation. I split the dataset into a training set and test set, and built two simple models - a <a href="https://en.wikipedia.org/wiki/Logistic_regression">logistic regression</a> and a <a href="https://en.wikipedia.org/wiki/Random_forest">random forest model</a>. In very light detail, a logistic regression is the most basic classification model based on the generalized linear model and a random forest model is a decision tree-based algorithm. With no <a href="https://www.datarobot.com/wiki/tuning/">tuning</a> applied, neither model performed particularly well - the logistic regression and random forest models had accuracies of 85.5% and 83.8% on the test set, respectively. While the logistic regression had a slightly higher accuracy on the test set, the random forest performed better on the metric of <a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">area under the ROC (receiver-operator characteristic)</a> curve - 0.899 compared to 0.888 (generally, binary classification systems with ROC AUC values close to 1 perform better). A comparison between the two ROC curves is shown below.</p>
<p>It’s not perfect, but the purpose was to explore the tidymodels framework, and I’m pretty happy with the outcome/practice along the way.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/pics/roc_auc.png" class="img-fluid"></p>
</section>
<section id="some-things-to-readwatchlisten-to" class="level1">
<h1>Some Things to Read/Watch/Listen to</h1>
<ul>
<li>There’s been a concerted effort by prominent conservatives to <a href="https://twitter.com/gelliottmorris/status/1424524749875601408?s=21">promote vaccination</a> and <a href="https://www.reviewjournal.com/opinion/letters/letter-dont-blame-the-gop-for-vaccine-hesitancy-2413731/amp/">shift the blame for vaccine hesitancy to the Biden administration</a>, pointing in particular to one of Kamala Harris’ comments during the Vice Presidential debate. This criticism falls fairly short, given that commentators like <a href="https://www.youtube.com/watch?v=ocEFTIwnO6I">Tucker Carlson</a> and legislators like <a href="https://www.cnn.com/2021/08/10/tech/twitter-marjorie-taylor-greene/index.html">Marjorie Taylor Green</a> continue to spread vaccine conspiracy theories. Further, a <a href="https://www.economist.com/graphic-detail/2021/07/30/which-americans-are-against-the-jab">statistical model by the Economist</a> found that the strongest predictor of whether or not someone has been vaccinated is who they voted for in the 2020 presidential election.</li>
<li>Julia Silge was recently featured as a guest on an excellent episode of the <a href="https://www.youtube.com/watch?v=p7z8yZucwlM">Not So Standard Podcast</a>. Well worth a listen for R dorks like myself.</li>
<li>Perry Bacon Jr wrote an <a href="https://www.washingtonpost.com/opinions/2021/08/09/why-moderation-doesnt-guarantee-electoral-success-biden-democrats/">informative piece</a> on the misplaced importance on swing voters in election cycles.</li>
</ul>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Tidymodels and the {Titanic}},
  date = {2021-08-08},
  url = {https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Tidymodels and the Titanic.”</span> August 8,
2021. <a href="https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic">https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>rstats</category>
  <category>tidymodels</category>
  <guid>https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/index.html</guid>
  <pubDate>Sun, 08 Aug 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-08-08-tidymodels-and-the-titanic/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>The Gas Price Fallacy</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-07-18-the-gas-price-fallacy/index.html</link>
  <description><![CDATA[ 




<p>As America has vaccinated its population, life has seemingly begun to return to the pre-pandemic normal. Businesses have been opening to higher levels of capacity, schools are planning for higher levels of in-person learning in the fall, and, notably, Americans have returned to <a href="https://covid19.apple.com/mobility">pre-pandemic levels of transit</a>.</p>
<p><a href="https://twitter.com/existentialfish/status/1377779116414533638">Conservative commentators</a> and <a href="https://twitter.com/Jim_Jordan/status/1406966549714440196">representatives</a> have pointed out that prices of commodity goods - in particular, gasoline - have skyrocketed over the past year and attribute this increase to Biden’s presidency. Looking at retail gasoline prices, we can see a steady increase since Biden took office.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-07-18-the-gas-price-fallacy/plot_01.png" class="img-fluid"></p>
<p>What they fail to point out, however, is that the price of gasoline (and other commodities) significantly dropped during the pandemic, and that the increases are largely a return to pre-pandemic prices.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-07-18-the-gas-price-fallacy/plot_02.png" class="img-fluid"></p>
<p>While there are certainly opportunities to critique the current administration’s energy policy (<a href="https://apnews.com/article/joe-biden-billings-a3a37acf2fce55449b704b01badc1f67">banning new drilling leases on federal land/water</a> and <a href="https://apnews.com/article/donald-trump-joe-biden-keystone-pipeline-canada-environment-and-nature-141eabd7cca6449dfbd2dab8165812f2">canceling the Keystone XL pipeline’s border-crossing permit</a>, for example), attributing the recent return to pre-pandemic gasoline prices is a particularly weak and intentionally misleading avenue of attack.</p>
<p>As always, you can find my work on <a href="https://github.com/markjrieke/thedatadiary">github</a>.</p>
<section id="some-readingviewing-material" class="level3">
<h3 class="anchored" data-anchor-id="some-readingviewing-material">Some Reading/Viewing Material</h3>
<ul>
<li>The Economist wrote an <a href="https://www.economist.com/graphic-detail/2021/07/10/in-person-voting-really-did-accelerate-covid-19s-spread-in-america">interesting article</a> finding a significant link between a county’s in-person voting rate and new COVID cases in November.</li>
<li>Elliot Morris summarized the work of several political scientists in a recent article describing <a href="https://gelliottmorris.substack.com/p/why-did-the-gop-slide-so-far-towards">why the GOP slid so far towards authoritarianism</a> in the past decade. The article is behind a subscriber paywall, but is well worth the read. In short, however, “ethnically antagonistic” voters are much more likely to agree with statements traditionally viewed as authoritarian. This group hadn’t coalesced under a single party until Trump brought these anti-racial voters into the party (recall his role in the <a href="https://www.theatlantic.com/ideas/archive/2020/05/birtherism-and-trump/610978/">birther conspiracy</a> and the <a href="https://www.cnn.com/2016/08/31/politics/2016-election-donald-trump-hillary-clinton-race/index.html">racial antagonism surrounding his 2016 campaign</a>), at which point democratic (note, small “d”) norms became a partisan issue.</li>
<li>In my machine learning class, I’ve started learning about the implementation of neural networks. The course’s instruction style is highly technical, but Grant Sanderson’s <a href="https://www.youtube.com/watch?t=1015s&amp;v=aircAruvnKk">series on neural networks</a> has helped me align a technical and intuitive understanding of the topic.</li>
</ul>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {The {Gas} {Price} {Fallacy}},
  date = {2021-07-18},
  url = {https://www.thedatadiary.net/posts/2021-07-18-the-gas-price-fallacy},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“The Gas Price Fallacy.”</span> July 18, 2021.
<a href="https://www.thedatadiary.net/posts/2021-07-18-the-gas-price-fallacy">https://www.thedatadiary.net/posts/2021-07-18-the-gas-price-fallacy</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-07-18-the-gas-price-fallacy/index.html</guid>
  <pubDate>Sun, 18 Jul 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-07-18-the-gas-price-fallacy/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Blexas?</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-07-11-blexas/index.html</link>
  <description><![CDATA[ 




<p>Last year, Donald Trump won Texas’ 38 electoral votes handily, <a href="https://en.wikipedia.org/wiki/2020_United_States_presidential_election_in_Texas">earning 52% of the vote compared to Biden’s 46% (R+6)</a>. Taken on its own, this is hardly surprising - <a href="https://www.270towin.com/states/Texas">Texas has gone to the Republican presidential candidate in every election since 1980</a>. Looking at the relative gains made in Texas over recent election cycles, however, paints a much more hopeful picture for Democrats hoping to flip the state &amp; garner the nickname, “blexas.”</p>
<p>On election day, FiveThirtyEight and the Economist gave Biden a <a href="https://projects.fivethirtyeight.com/2020-election-forecast/texas/">38%</a> and <a href="https://projects.economist.com/us-2020-forecast/president/texas">30%</a> chance of winning in Texas, respectively. While still bearish on Biden, this is far more bullish than 2016, when FiveThirtyEight’s model gave Clinton a mere <a href="https://projects.fivethirtyeight.com/2016-election-forecast/texas/#plus">5%</a> chance of winning in Texas (in fact, both FiveThirtyEight and the Economist were more confident in Biden’s chance of winning Texas in 2020 than FiveThirtyEight was that Trump would win the presidency in 2016 (<a href="https://projects.fivethirtyeight.com/2016-election-forecast/#plus">28%</a>)). Part of this shift can be attributed to Democratic gains nationally, but Texas Democrats have been steadily gaining more ground than can be explained by national swing.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-07-11-blexas/pics/plot_01.png" class="img-fluid"></p>
<p>The Cook Political Report publishes its <a href="https://cookpolitical.com/analysis/national/pvi/introducing-2021-cook-political-report-partisan-voter-index">Partisan Voter Index</a> (PVI) following each presidential election. PVI is a measure of how a state, district, or county votes relative to the national environment. For example, say a Democratic candidate wins 53% of the two-party voteshare nationally, but 51% in a given state. Despite the state going to the Democratic candidate, the state PVI would be R+2%, since the candidate performed 2% under the national vote (the actual PVI calculated in the Cook report is slightly more involved, but this basic understanding is sufficient for our purposes). Looking at Texas’ PVI over past elections, we see that Democrats have been making relative gains in every election since 2004, despite Texas still voting more Republican than the nation.</p>
<p>Much of this can likely be attributed to demographic shifts drive by major Texas cities - <a href="https://demographics.texas.gov/Resources/Presentations/OSD/2021/2021_01_15_LeadershipNorthTexas.pdf">Dallas, Houston, Austin, and San Antonio have seen massive population increases</a>, largely due to domestic and international migration (as opposed to natural changes - e.g., births). As Texas grows, it also continues to diversify. The non-hispanic white population in Texas dropped from 45% in 2010 to 41% in 2019, and non-white population groups have driven growth over the past 10 years.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-07-11-blexas/pics/txdemographics.jpg" class="img-fluid"></p>
<p>All that being said, while I expect that Texas will continue to experience demographic shifts that are favorable in the eyes of Democratic politicians, in the absence of any real modeling work, I’m hesitant to say that Texas will turn blue in the near term. Despite gains in the presidential results, Texas Democrats <a href="https://en.wikipedia.org/wiki/2020_United_States_House_of_Representatives_elections_in_Texas#Results_summary">didn’t outperform expectations in the house</a>, nor did they even advance a candidate in the special election for TX-06 (two Republican candidates advanced to a runoff). Governor Abbott is also introducing a <a href="https://www.nytimes.com/2021/07/07/us/politics/texas-abbott-voting-laws-transgender-rights.html">special legislative session</a> with one goal (of many) of making Texas a state with some of the most restrictive voting laws with targeted partisan effects. Looking to other states as a reference, North Carolina had also seen similar PVI shifts in the past without resulting in Democratic victories (though, to be fair, North Carolina hasn’t experienced the same level of demographic shift that Texas is undergoing).</p>
<p>Perhaps there is some modeling work I can do to produce a more definitive stance, but until then, I’ll hold on making any bold predictions.</p>
<p>As always, you can find my work on <a href="https://github.com/markjrieke/thedatadiary">github</a>.</p>
<section id="general-updates" class="level3">
<h3 class="anchored" data-anchor-id="general-updates">General Updates</h3>
<p>It’s been quite a while, but it’s good to get back into writing again. I wrote the scripts/made the charts for this post about two weeks ago, but haven’t had the time (or rather, haven’t made the time) to write the post itself. While I feel like I’ve been saying this for three months now, I do hope to get back to a more regular schedule soon - perhaps biweekly, to avoid rushing projects. We’ll see - in any regard, here are some updates that I’m excited about:</p>
<ul>
<li>I started my new job a few weeks ago! It’s both very rewarding (I get to use R &amp; work with large polling datasets daily!) and very demanding. I enjoy the challenge &amp; am excited for upcoming projects that I’ve been tasked with.</li>
<li>I’ve been steadily making headway against the Machine Learning course I’ve been taking - at this point, I’m about halfway finished.</li>
<li>I’ve begun to poke around in the tidymodels framework. I’m interested in the standardization the packages supply for generating models in R.</li>
</ul>
<section id="some-readingviewing-material" class="level4">
<h4 class="anchored" data-anchor-id="some-readingviewing-material">Some reading/viewing material:</h4>
<ul>
<li>I linked to it above, but it’s worth reading through this <a href="https://www.nytimes.com/2021/07/07/us/politics/texas-abbott-voting-laws-transgender-rights.html">NYT article on the special legislative session in Texas</a>. I only touched on voting rights, but session is primed as another hot-button issue session following spring’s ultra-conservative agenda.</li>
<li>Checks and Balance, the Economist’s weekly podcast, focused on Critical Race Theory &amp; the troubled history of race in American education in their most recent podcast, “<a href="https://open.spotify.com/show/4jjKHhNPHfkIZHssgrQavP">History Test</a>.” It’s well worth a listen, especially if you’re like me, and had never heard of CRT until recently.</li>
<li>Just over 6 months ago on January 6th, violent Trump supporters stormed the U.S. capitol. With time and <a href="https://www.msnbc.com/opinion/gop-lies-about-jan-6-are-getting-bolder-more-dangerous-n1267178">overt lies</a> being propagated by Fox News, OANN, and Newsmaxx, it’s easy to forget exactly what happened and how it felt on that day. This <a href="https://www.youtube.com/watch?v=jWJVMoe7OY0">NYT Visual Investigation</a> does an excellent job of reconstructing the timeline of the events that day.</li>
</ul>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Blexas?},
  date = {2021-07-11},
  url = {https://www.thedatadiary.net/posts/2021-07-11-blexas},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Blexas?”</span> July 11, 2021. <a href="https://www.thedatadiary.net/posts/2021-07-11-blexas">https://www.thedatadiary.net/posts/2021-07-11-blexas</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-07-11-blexas/index.html</guid>
  <pubDate>Sun, 11 Jul 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-07-11-blexas/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>COVID Cases Improve with Introduction of Vaccines</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-06-03-covid-cases-improve-with-introduction-of-vaccines/index.html</link>
  <description><![CDATA[ 




<p>As vaccines have become widely available in the US, new COVID cases and deaths have dropped significantly from winter peak, with the 7-day average for both cases and deaths nearing the averages reported during the initial lockdown in the summer of last year (note that, in the chart for the 7-day average of deaths below, the scale is restricted to 15 deaths per million; this cuts off some of the state surges, but shows the US average better than a <a href="https://github.com/markjrieke/thedatadiary/raw/main/2021.05.30-COVID/p3.png">chart with an unedited scale</a>).</p>
<p><img src="https://www.thedatadiary.net/posts/2021-06-03-covid-cases-improve-with-introduction-of-vaccines/pics/plot_01.png" class="img-fluid"></p>
<p><img src="https://www.thedatadiary.net/posts/2021-06-03-covid-cases-improve-with-introduction-of-vaccines/pics/plot_03.png" class="img-fluid"></p>
<p>According to the US Vaccine Tracker, <a href="https://twitter.com/USVaccineCount">41% of Americans are fully vaccinated</a> as of today. Even more heartening is the fact that the partisan divide regarding vaccine hesitancy, while still existent, <a href="https://twitter.com/gelliottmorris/status/1397579777448550404">is shrinking</a>.</p>
<p>While this is certainly good news about the country as a whole, individual states, counties, and cities may have varying levels of success in curbing the spread of the virus in the local community. The New York Times created a <a href="https://www.nytimes.com/interactive/2021/us/covid-cases-deaths-tracker.html">helpful dashboard</a> that lets you look at the spread of the virus on a state, county, or metro area scale.</p>
<p>All this is to say that, while the pandemic is still not (and possibly will never be) a thing of the past, the introduction of vaccines certainly has appeared to help curb the spread.</p>
<section id="catching-up" class="level3">
<h3 class="anchored" data-anchor-id="catching-up">Catching Up</h3>
<p>It’s been a while since I’ve written, due to a flurry of weddings and trips. While I had originally hoped to get back onto a regular weekly writing schedule, I will again have to push out the next post until late June, due to some exciting personal news: June 21st, I’ll be starting a new job! I’ll be transitioning from engineering in the oil &amp; gas industry to healthcare analytics, which I’m really excited about! In the meantime, however, there’s a flurry of work to do in my current job to ensure that the person backfilling me is prepared to pick up the projects I’m working on. Hopefully after that, I can get back to a regular schedule.</p>
<p>As always, you can find my work on <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.05.30-COVID">github</a>.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {COVID {Cases} {Improve} with {Introduction} of {Vaccines}},
  date = {2021-06-03},
  url = {https://www.thedatadiary.net/posts/2021-06-03-covid-cases-improve-with-introduction-of-vaccines},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“COVID Cases Improve with Introduction of
Vaccines.”</span> June 3, 2021. <a href="https://www.thedatadiary.net/posts/2021-06-03-covid-cases-improve-with-introduction-of-vaccines">https://www.thedatadiary.net/posts/2021-06-03-covid-cases-improve-with-introduction-of-vaccines</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <guid>https://www.thedatadiary.net/posts/2021-06-03-covid-cases-improve-with-introduction-of-vaccines/index.html</guid>
  <pubDate>Thu, 03 Jun 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-06-03-covid-cases-improve-with-introduction-of-vaccines/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>President of the Polls</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-05-05-president-of-the-polls/index.html</link>
  <description><![CDATA[ 




<p>Elliot Morris wrote in his <a href="https://gelliottmorris.substack.com/p/are-preferences-for-more-government">newsletter last week</a> about the increase in the public’s opinion that the government ought to be doing more. A summary of the last twenty years of polling by NBC shows that, while there seems to be a reactive effect based on the party of the president, support for increased government activity has generally been on the rise.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-05-05-president-of-the-polls/govt.png" class="img-fluid"></p>
<p>The combination of Biden’s <a href="https://www.pewresearch.org/politics/2021/03/11/biden-viewed-positively-on-many-issues-but-public-is-less-confident-he-can-unify-country/">approval across several categories</a>, <a href="https://www.nytimes.com/2021/02/04/us/politics/biden-approval-rating-republicans.html">public support of his proposals</a> (with the exception of his original cap on refugees, which he then <a href="https://www.cnn.com/2021/05/03/politics/refugee-cap/index.html">raised after public outcry</a>), and the public support of increased government activity gives Biden a strong argument in pressing congress to get his progressive policies pushed through to his desk. Despite the popularity, his $4 trillion <a href="https://www.nytimes.com/2021/04/28/upshot/biden-families-plan-american-rescue-infrastructure.html">infrastructure and families plan</a> largely depends on what the senate parliamentarian will allow into a reconciliation bill (which only needs majority approval, rather than a filibuster-proof 60 votes) and the votes of a few moderate Democratic senators, since the bills will receive <a href="https://nypost.com/2021/05/04/mcconnell-no-gop-senator-will-back-bidens-4-trillion-infrastructure-plan/">no Republican support in the senate</a>.</p>
<section id="outlook-for-the-coming-weeks" class="level3">
<h3 class="anchored" data-anchor-id="outlook-for-the-coming-weeks">Outlook for the Coming Weeks</h3>
<p>I’ll be taking a break for the next few weeks, due to a flurry of weekend trips/weddings now that I/most of my friends are fully vaccinated. I’ll continue to work on the database in the background (notably, I need to dive deep into the census bureau demographic data, which needs a lot of fixing). I’ll likely write a short update in either late May or early June.</p>
<p>As always, you can find my work on <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.05.03-misc_ish">Github</a>.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {President of the {Polls}},
  date = {2021-05-05},
  url = {https://www.thedatadiary.net/posts/2021-05-05-president-of-the-polls},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“President of the Polls.”</span> May 5, 2021. <a href="https://www.thedatadiary.net/posts/2021-05-05-president-of-the-polls">https://www.thedatadiary.net/posts/2021-05-05-president-of-the-polls</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-05-05-president-of-the-polls/index.html</guid>
  <pubDate>Wed, 05 May 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-05-05-president-of-the-polls/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>A Lukewarm Case for DC Statehood</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-04-27-a-lukewarm-case-for-dc-statehood/index.html</link>
  <description><![CDATA[ 




<p>Once again, I’ll be keeping this very short, as I’ve continued to primarily focus on <a href="https://github.com/markjrieke/electionsimulator/tree/main/notepad">building out the demographic/economic database</a>. I, did, however, sneak in some time to explore the <a href="https://www.census.gov/data/tables/2020/dec/2020-apportionment-data.html">2020 Census Apportionment Results</a> that were released yesterday. Some surprises came out of the release: Texas and Florida underperformed expectations, only gaining two and one seat, respectively; Arizona didn’t gain a seat; and New York lost a seat but was apparently <a href="https://www.nytimes.com/2021/04/26/nyregion/new-york-census-congress.html">89 people short of retaining its seats</a>. Given that Texas and Florida each gained one less seat than was generally expected, there’s been some speculation online that <a href="https://www.washingtonpost.com/business/are-you-a-citizen-the-trump-census-controversy-explained/2021/04/26/1cfe6ed8-a6e1-11eb-a8a7-5f45ddcdf364_story.html">Donald Trump’s attempt to undercount Hispanics</a> was successful, but backfired. I’ll hold my judgments on this theory until I can read some more in-depth opinions (if they get written).</p>
<p>With the new apportionment and population data, each individual’s representative power in congress has shifted. Including both Senators and House Representatives, states with smaller populations continue to have outsized representation in congress: Wyoming and Vermont have significantly more representatives per million residents than California or Texas, for example. Residents of Washington D.C., however, receive no representation in congress.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-04-27-a-lukewarm-case-for-dc-statehood/plot.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="">
<p>As a side note, the reps-per-million will be greater than the total number of congressional representatives in states with less than one million residents. This chart is really meant to compare the uneven representative power of each state.</p>
</div></div><p>If D.C. were to become a state, it would have outsized representative power, similar to Wyoming and Vermont, due to its size. That, however, isn’t really a justification to deny ~700,000 Americans national representation, and the arguments against D.C. statehood have been <a href="https://www.washingtonpost.com/opinions/treating-fellow-citizens-as-landfill/2021/03/24/f4c16d34-8c1a-11eb-a6bd-0eb91c03305a_story.html">weak at best</a> and <a href="https://www.cnn.com/2020/06/26/politics/tom-cotton-wyoming-dc-statehood/index.html">implicitly racist at worst</a>, given D.C.’s <a href="https://en.wikipedia.org/wiki/Washington,_D.C.#Demographics">majority-minority population</a>.</p>
<p>Still, it’s virtually impossible that D.C. statehood receive the filibuster-proof 60 votes in the Senate (I’d doubt that even a compromise of <a href="https://www.forbes.com/sites/andrewsolender/2021/04/22/gop-senator-introduces-bill-to-give-dc-to-maryland-as-statehood-bill-heads-to-senate/?sh=c66ab4c2ca30">retrocession into Maryland</a> would pass). For the time being, residents of D.C. will have to wait for representation until polarized ideological walls come down and Republicans vote for D.C. statehood, Democrats gain enough seats for a supermajority, or the filibuster is abolished.</p>
<p>As always, you can find my work on <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.04.27-bureau_results">Github</a>.</p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {A {Lukewarm} {Case} for {DC} {Statehood}},
  date = {2021-04-27},
  url = {https://www.thedatadiary.net/posts/2021-04-27-a-lukewarm-case-for-dc-statehood},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“A Lukewarm Case for DC Statehood.”</span> April
27, 2021. <a href="https://www.thedatadiary.net/posts/2021-04-27-a-lukewarm-case-for-dc-statehood">https://www.thedatadiary.net/posts/2021-04-27-a-lukewarm-case-for-dc-statehood</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-04-27-a-lukewarm-case-for-dc-statehood/index.html</guid>
  <pubDate>Tue, 27 Apr 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-04-27-a-lukewarm-case-for-dc-statehood/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Catching Up</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-04-20-catching-up/index.html</link>
  <description><![CDATA[ 




<p>The past few weeks have been a bit lite (read::absent) in terms of posting updates. When not taking the machine learning course, I’ve been spending quite a bit of time working on <a href="https://github.com/markjrieke/electionsimulator/tree/main/data/tidy">building out a database</a> of demographic data (from 1980 to 2019). The goal is to be able to build this database out once, then reference it repeatedly for future projects. If you’re so inclined, you can read my unedited ad-hoc thoughts while working on the database <a href="https://github.com/markjrieke/electionsimulator/tree/main/notepad">here</a>. There’s lots of code interspersed with prose, so it’s a bit of a slog to read through, but gives a really detailed account of how I worked through the different problems that arose.</p>
<p>That being said, I did have a bit of time to squeeze in a quick chart. YouGov recently conducted a <a href="https://today.yougov.com/topics/politics/articles-reports/2021/04/14/best-and-worst-states-democrats-republicans">poll</a> on each state’s favorability rating according to Democrats and Republicans. Not surprisingly, state favorability is closely aligned with Biden’s voteshare in November.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-04-20-catching-up/yougov.png" class="img-fluid"></p>
<p>I’ll keep this short and sweet. I may continue to write sparsely over the next month or so, due to a few trips (now that I have the COVID vaccine), but will continue to work on the database in the background.</p>
<p>As always, you can find my work on <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.04.18-misc">Github</a>.</p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Catching {Up}},
  date = {2021-04-20},
  url = {https://www.thedatadiary.net/posts/2021-04-20-catching-up},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Catching Up.”</span> April 20, 2021. <a href="https://www.thedatadiary.net/posts/2021-04-20-catching-up">https://www.thedatadiary.net/posts/2021-04-20-catching-up</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <guid>https://www.thedatadiary.net/posts/2021-04-20-catching-up/index.html</guid>
  <pubDate>Tue, 20 Apr 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-04-20-catching-up/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Seasonality is a Weak Predictor of Border Crossings</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings/index.html</link>
  <description><![CDATA[ 




<p>Last week, the Washington Post published an <a href="https://www.washingtonpost.com/politics/2021/03/23/theres-no-migrant-surge-us-southern-border-heres-data/">article</a> postulating that the recent increase in crossings at the border cannot be attributed to Biden administration policies, but rather is a function of seasonal patterns and pent up demand due to restricted travel in 2020. While the article is well intentioned, a simple linear model that predicts crossings based on month shows seasonality is a poor predictor (or, at least is a poor predictor on its own).</p>
<section id="examining-the-data" class="level1">
<h1>Examining the Data</h1>
<p>The US Border Patrol (USBP) publishes <a href="https://www.cbp.gov/newsroom/stats/southwest-land-border-encounters">monthly data</a> summarizing the number of encounters/crossings at the Southern border. Since November of 2020, border crossings have increased monthly, from about 70,000 in November to a little over 100,000 in February.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings/pics/plot_01.png" class="img-fluid"></p>
<p>Looking at the long term monthly data, however, reveals two key aspects:</p>
<ol type="1">
<li>2019 was an exceptionally high year for crossings, and 2021 is on track to have a similar number of crossings;</li>
<li>There seems to be a cyclical set of peaks and troughs in annual border crossing numbers.</li>
</ol>
<p><img src="https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings/pics/plot_02.png" class="img-fluid"></p>
<p>Looking at the chart above, it’s difficult to determine which months correspond to peaks and troughs. Aligning by month offers a clearer picture of how monthly border crossings in each year compare to other years.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings/pics/plot_03.png" class="img-fluid"></p>
<p>From this chart, it does appear that there is some semblance of a monthly pattern, albeit with extreme outliers of 2019, 2020, and 2021. Appearances, however, can be deceiving, and a mathematical model can help distinguish signal from noise. Using month as a predictive input, we can create a model that estimates the expected number of crossings in said month. If we look at the residual error (the actual number of crossings minus the predicted number of crossings) over time, we can get an idea of how well the model is performing. If seasonality is a good predictor of the number of border crossings, the model will accurately account for seasonal shifts, and the residual error plot would be expected to remove or reduce the “waviness” that appears in the crossing plot and only show the long term trends.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings/pics/plot_04.png" class="img-fluid"></p>
<p>Plotting the residual error, however, doesn’t filter out seasonal noise. In fact, apart from the y-axis shifting down, the residual plot is strikingly similar to the crossings plot. This means that the month offers little power on its own in predicting the number of border crossings.</p>
</section>
<section id="closing-remarks" class="level1">
<h1>Closing Remarks</h1>
<p>The Washington Post article makes good points that aren’t discussed fully here, but are worth mentioning:</p>
<ul>
<li>Those who planned on crossing the border in 2020 but couldn’t due to travel restrictions may have simply waited until now to travel.</li>
<li>Unaccompanied migrants are arriving at the border in rates that exclude the possibility of seasonal patterns.</li>
</ul>
<p>Also notable is that seasonal patterns - while not a good predictor of the number of border crossings on its own - may be more impactful in a more robust model. <a href="https://www.nbcsandiego.com/news/local/professor-reacts-to-wapo-articles-claims-border-is-not-seeing-surge-or-crisis/2559256/">As a professor from the University of San Diego explains</a>, conditions in the migrant’s country of origin and the countries they pass through are among a host of variables that play a significant role in determining if migrants make the trip to the US border. While a more robust model may be able to accurately incorporate season into its predictions, simply using month as a predictor, as the Washington Post does in their article, does not explain the surge at the border (evidenced by the fact that this equally simple model refutes their finding).</p>
<p>Finally, it should be noted that, above all else, there is a humanitarian crisis at the border. If you’d like to find a way to help or donate, <a href="https://www.globalgiving.org/us-mexico-border-crisis/">Global Giving</a> is an excellent resource.</p>
</section>
<section id="some-other-updates" class="level1">
<h1>Some Other Updates</h1>
<p>Here’s what I’ve been working on recently:</p>
<ul>
<li><strong>TidyTuesday</strong>: I’ve made my first contribution to <a href="https://twitter.com/search?q=%23tidytuesday&amp;src=typed_query">#tidytuesday</a>! For those who are unaware, TidyTuesday is a weekly data project in R for the R4DS (R for data science) community. Each week, a public dataset is released on Monday, allowing users to explore and create interesting visualizations and analyses based on the dataset. This week, a <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-04-06/readme.md">dataset</a> based on global deforestation was released, but it came along with interesting information on the production of vegetable oil. I plotted the global annual vegetable oil production by crop type in the steamgraph below.</li>
</ul>
<p><img src="https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings/pics/tidytuesday15.png" class="img-fluid"></p>
<ul>
<li><strong>Courses</strong>: I’ve continued with the machine learning and Bayesian courses, though I’ve descoped to roughly two days each week, as my personal schedule has gotten quite hectic. The ML course is excellent for understanding the theory that goes into each algorithm, but in practice, I expect that I will likely make use of the tidymodels R package’s relatively simple interface.</li>
<li><strong>Rmd</strong>: I’ve started writing my code in a R markdown document, which allows me to mix both code and prose. I mix in some off-the-rails/stream of consciousness commentary as I step through the process to get to a functional code. For regularly updated/critical code/projects, I’ll still stick to concise scripts.</li>
</ul>
<p>That’s all for this week - as always, you can read through the code for <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.04.02-border_crossings">this piece</a> or for the <a href="https://github.com/markjrieke/thedatadiary/blob/main/tidytuesday/2021.04.05-deforestation/tidydeforestation.md">tidytuesday</a> piece on github. See you next week.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Seasonality Is a {Weak} {Predictor} of {Border} {Crossings}},
  date = {2021-04-05},
  url = {https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Seasonality Is a Weak Predictor of Border
Crossings.”</span> April 5, 2021. <a href="https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings">https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings/index.html</guid>
  <pubDate>Mon, 05 Apr 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-04-05-seasonality-is-a-weak-predictor-of-border-crossings/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Recent Works</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-03-15-recent-works/index.html</link>
  <description><![CDATA[ 




<p>One of the history teachers at my highschool was known for his prolific catchphrase, “give me the stuff, not the fluff,” often uttered to students attempting to submit history papers padded with superfluous words and sentences in order to meet a minimum word threshold. While I never took a class with this teacher, the phrase has stuck with me. With that in mind, I’ve reprioritized some of the things I’ve been working on. Here’s what I’ve been up to over the past week:</p>
<ul>
<li><strong>TX COVID Tracker</strong>: Over the weekend, I put together and published my first Shiny application, a county-level <a href="https://thedatadiary.net/texas-covid-tracker">interactive Texas COVID tracker</a>. Using <a href="https://github.com/nytimes/covid-19-data">data from the New York Times</a>, the tracker lets the user view county-level historical data. The goal is to fill in the gaps of the <a href="https://www.nytimes.com/interactive/2020/us/texas-coronavirus-cases.html">Times’ Texas tracker</a>, which shows historical state data and live county data, but doesn’t offer historical county data.<br>
</li>
<li><strong>Classes</strong>: I had previously spent evenings working on projects in R and had pushed off some of the statistics classes to focus on these projects. This past week, I’ve scheduled an hour each day for dedicated class time, alternating daily between a Bayesian inference course and a machine learning course.</li>
</ul>
<section id="my-plans-for-the-upcoming-week" class="level3">
<h3 class="anchored" data-anchor-id="my-plans-for-the-upcoming-week">My plans for the upcoming week:</h3>
<ul>
<li><strong>TX COVID Tracker</strong>: While the interactive tracker is functional, it still leaves a lot to be desired. Being the first Shiny app I developed, I ran into a lot of learning curve issues but should be able to make updates more quickly. This upcoming week, I plan on converting to a <a href="https://rstudio.github.io/shinythemes/">bootstrap layout</a>, adding in an interactive state map with <a href="https://rstudio.github.io/leaflet/shiny.html">leaflet</a>, adding in statewide <a href="https://dshs.texas.gov/coronavirus/AdditionalData.aspx">hospitalization and vaccination information</a>, adding a state and county level <a href="https://www.youtube.com/watch?t=10s&amp;v=54XLXg4fYsc">log-log plot</a>, making some formatting changes to help with mobile viewing, and updating themes/appearances. Eventually, I’d like to write a <a href="https://cran.r-project.org/web/packages/taskscheduleR/vignettes/taskscheduleR.html">scheduleR</a> script to automatically update the data, but that may need to be put off to focus on the laundry list above.</li>
<li><strong>Classes</strong>: I’ll still continue with the daily schedule for coursework and may be able to finish the Bayesian inference course this week.</li>
</ul>
<p>Between the COVID tracker and classes, I don’t think I’ll have too much time to work on anything else. That being said, I’ve got some projects/articles in the backlog that I’m looking forward to working on:</p>
<ul>
<li><strong>Polarization - top down or bottom up?</strong> It’s no secret that we are living in the <a href="https://voteview.com/articles/party_polarization">most polarized political landscape since the Civil War</a>, but I’m interested in exploring where this polarization originates. Do elected politicians split the public by pushing increasingly divisive policies? Or do voters lead the polarization effort by increasingly self-segregating into isolated camps?</li>
<li><strong>Two Party PVI (Partisan Voter Index)</strong>: The <a href="https://cookpolitical.com/pvi-0">partisan voter index (PVI)</a> is a measure of a state’s (or county’s) partisan preference relative to the national environment. There’s a story here about how the national environment is progressing - are our country voting preferences converging or diverging? What states are trending towards Democrats? What states are trending towards Republicans?</li>
<li><strong>The Gas Price Fallacy</strong>: I’ve seen quite a few <a href="https://twitter.com/ksorbs/status/1362540095241347073">bad faith attempts to blame increasing gas prices on Joe Biden</a> recently. Additionally, it’s particularly frustrating that I’ve seen a number of my colleagues in the oil &amp; gas industry repeat this nonsense. As a working member of the oil &amp; gas industry, I think I’m qualified and have a duty to explain why the administration change isn’t the cause of the rising gas prices (the TL;DR version is that we’re recovering from a global pandemic &amp; oil oversupply, you can see that gas prices are just returning to pre-COVID Trump administration levels<a href="https://www.gasbuddy.com/charts">here</a>.)</li>
</ul>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Recent {Works}},
  date = {2021-03-15},
  url = {https://www.thedatadiary.net/posts/2021-03-15-recent-works},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Recent Works.”</span> March 15, 2021. <a href="https://www.thedatadiary.net/posts/2021-03-15-recent-works">https://www.thedatadiary.net/posts/2021-03-15-recent-works</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <guid>https://www.thedatadiary.net/posts/2021-03-15-recent-works/index.html</guid>
  <pubDate>Mon, 15 Mar 2021 05:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-03-15-recent-works/icon.png" medium="image" type="image/png" height="132" width="144"/>
</item>
<item>
  <title>aRtwork!</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-03-07-artwork/index.html</link>
  <description><![CDATA[ 




<p><img src="https://www.thedatadiary.net/posts/2021-03-07-artwork/p_art.png" class="img-fluid"></p>
<p>This week, I did something a bit different - the artwork above was made in R! The code to create the graph is actually pretty short, only taking up 28 lines. The bulk of the work was spent writing the csv containing all the polygon points and colors. I spent most of the past week doing some back end work that will pay off in the future. Namely, I set up a local clone of my repository on github and figured out how to embed Shiny applications on Squarespace.</p>
<p>I’d like to address something that has been nagging me for a bit. Last week, I wrote about Georgia’s special senate race. I spent a lot of time learning new packages and methods, and am happy with how the plots and majority of the post turned out. Near the end of the post, however, I made the conjecture that Doug Collins may have seen an opportunity to run against Kelly Loeffler because she was a polarizing candidate with a string of controversies surrounding her campaign. While I shared sources that generally support this position, I didn’t back it up with any sort of data or in-depth analysis. I’m not a political scientist nor am I an expert in election strategy, so in hindsight I think it was pretty irresponsible to add my uninformed opinion to the post. I’ll leave the post up unedited, since it’s important to keep a true record of what I’ve written, but moving forward, I’ll be better about writing the story the data reveals, rather than one I’d like to believe.</p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {aRtwork!},
  date = {2021-03-07},
  url = {https://www.thedatadiary.net/posts/2021-03-07-artwork},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“aRtwork!”</span> March 7, 2021. <a href="https://www.thedatadiary.net/posts/2021-03-07-artwork">https://www.thedatadiary.net/posts/2021-03-07-artwork</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <guid>https://www.thedatadiary.net/posts/2021-03-07-artwork/index.html</guid>
  <pubDate>Sun, 07 Mar 2021 06:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-03-07-artwork/featured.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Doug Collins Saved Raphael Warnock’s Senate Bid</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/index.html</link>
  <description><![CDATA[ 




<p>I’ll be honest - prior to writing this post, I had never heard of Doug Collins (R), the third major candidate in the race for Georgia’s special senate election after Raphael Warnock (D) and Kelly Loeffler (R). I wasn’t particularly tuned in to the Georgia senate elections prior to the runoff (by which time, the special election race had narrowed to just Warnock and Loeffler) and most of the coverage I had seen prior to Nov.&nbsp;3rd pitted Warnock against Leoffler, without considering Collins. Even Google search trends show that people were more interested in Loeffler than Collins leading up to the election.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/pics/plot_01.png" class="img-fluid"></p>
<p>Despite my ignorance, Collins was a major candidate in the special election, and ended up with a significant portion of the republican vote. It may be a bit obvious, but republicans splitting votes between Loeffler and Collins made Warnock a significantly more competitive candidate. However, the role of voter dropoff relative to the regular senate election is worth exploring in detail.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/pics/plot_02.png" class="img-fluid"></p>
<section id="comparing-results" class="level1">
<h1>Comparing Results</h1>
<p>Georgia’s regular senate election was a much more typical election than the special election - a tightly contested election between two candidates, Jon Ossoff (D) and David Perdue (R). The county result map comparing the voteshare of the two major candidates shows democratic strongholds in urban areas and a republican lean in rural areas. The county result map of the special election, if comparing Warnock to both Loeffler and Collins, is noticeably redder.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/pics/plot_03.png" class="img-fluid"></p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/pics/plot_04.png" class="img-fluid"></p>
<p>If we remove Collins, however, and just look at the county map comparing the top two candidates, the map shifts drastically in Warnock’s favor.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/pics/plot_04.png" class="img-fluid"></p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/pics/plot_05.png" class="img-fluid"></p>
<p>At face value, this explains how Warnock was able to advance to the runoff - split ticket votes aren’t usually good for the party with multiple major candidates. Voter dropoff between the regular and special election, however, shows just how much this pushed Warnock over the edge.</p>
</section>
<section id="voter-retention-a-tale-of-two-elections" class="level1">
<h1>Voter Retention: a Tale of Two Elections</h1>
<p>About 5 million Georgians voted in each of the senate elections in November. In the regular election, the major candidates, Ossoff and Perdue, accounted for about 98% of the votes, the rest going to Libertarian Shane Hazel or other write-in candidates. In the special election, on the other hand, a huge portion of Georgia voters didn’t vote for the major candidates - Warnock, Loeffler, and Collins only account for 79% of the votes! That’s about a 1 million voters who didn’t vote for their party’s major candidate (i.e., “dropped-off”).</p>
<p>To get a clear grasp of what voter retention means in this context, let’s consider a hypothetical county with 100 voters, of which 60 voted for Perdue and 40 voted for Ossoff in the regular election. Let’s also say these 100 voters split their special election votes in the following way: 35 votes for Loeffler, 15 votes for Collins, 30 votes for Warnock, and 20 write-in votes. In this scenario, Warnock retained 75% of regular election votes (30 / 40 = 75%), republicans, collectively, retained 83% ([35 + 15] / 60 = 83%), and Loeffler retained 58% (35 / 60 = 58%). In this hypothetical county, republicans collectively improved relative to the regular election, since they had a greater vote retention, but Loeffler on her own worsened, despite winning more votes than Warnock.</p>
<p>If we compare retentions for the entire state of Georgia, we can see that Loeffler and Collins were collectively better at retaining regular election votes than Warnock, retaining about 90% of Perdue votes compared to Warnock’s retention of about 68% of Ossoff votes. On her own, however, Loeffler was worse at retaining votes than Warnock, retaining a little over 50% of Perdue votes. This means that Warnock improved democratic performance relative to the regular election when compared against Loeffler directly.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/pics/plot_06.png" class="img-fluid"></p>
<p>Repeating this comparison across every county in Georgia shows that Loeffler and Collins, collectively, improved republican performance relative to the regular senate election across every single county. When, however, Collins is omitted, and Warnock and Loeffler are compared directly, democratic performance improves across the majority of counties.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/pics/plot_07.gif" class="img-fluid"></p>
</section>
<section id="in-summary" class="level1">
<h1>In Summary</h1>
<p>While it was obvious from the beginning that the split ticket hurt republicans in Georgia’s special senate election, it’s interesting to see just how much this split ticket helped Warnock. Collectively, republicans handily won the special election, but splitting votes between Loeffler and Collins meant that Warnock ended up winning a <a href="https://en.wikipedia.org/wiki/Plurality_(voting)">plurality</a> of the votes.</p>
<p>Political analysists are probably better than me at examining why multiple republicans ran as major contenders for the special senate election, but a quick take is that Kelly Loeffler wasn’t a particularly strong candidate. Although she was an incumbent, she wasn’t a senator any Georgian had ever voted for - <a href="https://www.ajc.com/news/state--regional-govt--politics/inside-how-kemp-picked-loeffler-for-the-senate/ftgH6xSI2Lnl0QLgqSQu8O/">she gained her senate seat through appointment</a>. Loeffler <a href="https://www.nytimes.com/2020/10/05/us/politics/kelly-loeffler-georgia.html">came to office as a moderate</a>, but quickly pivoted to a more <a href="https://projects.fivethirtyeight.com/congress-trump-score/kelly-loeffler/">Trumpy ideology</a>, eventually defining herself as “more conservative than Atilla the Hun” in a campaign ad (I would normally just add a hyperlink, but this ad is just too weird not to link directly - I originally thought this was a bad parody).</p>
<div class="quarto-video ratio ratio-16x9"><iframe src="https://www.youtube.com/embed/4pfvEFPvVGA" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Her campaign was also plagued by a few scandals, like <a href="https://www.ibtimes.sg/kelly-loefflers-campaign-caught-darkening-skin-opponent-raphael-warnock-facebook-ad-54651">darkening Warnock’s skin in a campaign ad</a>, taking photos with <a href="https://www.washingtonpost.com/nation/2020/12/14/loeffler-chester-doles-kkk-photo/">known KKK members</a>, and potentially <a href="https://www.politifact.com/factchecks/2020/oct/31/raphael-warnock/fact-checking-raphael-warnocks-claim-georgia-sen-k/">making stock trades based on COVID-19 information not-yet released to the public</a>. It’s a bit of a conjecture, so take this with a grain of salt, but all of the above factors may have provided Collins an opportunity to run as a stronger &amp; less divisive alternative to Loeffler.</p>
</section>
<section id="some-final-notes" class="level1">
<h1>Some Final Notes</h1>
<p>Choropleth charts (maps) can be misleading in the wrong context - it’s easy to subconsciously associate area with population. It wasn’t particularly relevant to the post above, but in spirit of the animation “<a href="https://s3files.core77.com/blog/images/960537_81_90771_DrdO3qFgW.gif">Land doesn’t vote, people do</a>”, I added dot-plot maps where bubble size corresponds to total number of votes.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/pics/plot_08.png" class="img-fluid"></p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/pics/plot_09.png" class="img-fluid"></p>
<p>As always, source data and code can be found on <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.02.28-ticket_splitting">github</a>. I’m particularly happy with how this post turned out. I learned a lot of new things worth highlighting (some of this gets into technical mumbo jumbo):</p>
<ul>
<li>Learned how to use the maps, gganimate, and gifski packages;</li>
<li>Picked up new method of piping objects into a ggplot object;</li>
<li>Worked with geom_col and geom_poly for the first time;</li>
<li>Used forcats for the first time (just to reorder a factor, but I’ll still count it as a win);</li>
<li>Added new colors to the dd color palette;</li>
<li>Created a reusable theme var to reduce code;</li>
<li>Started using tibbles.</li>
</ul>
<p>For this post, I had originally wanted to compare presidential vote to senate, governor, and house vote, but I had to pivot a bit to just the Georgia senate elections, for a few reasons. Firstly, the senate county dataset from Kaggle, for whatever reason, doesn’t include the winner of each county. Adding this by hand, just for Georgia’s 159 counties and two senate elections took hours. There’s probably a more efficient way to do this by scraping the data from online, but then I’d have to have learned a scraping package in addition to all of the other packages. I may have to hold on the original post idea for a bit while I pick up these skills.</p>
<p>That being said, I’ve already started working on next week’s post. It’s a bit of a departure from what I’ve been doing, so I’m excited to see how it’ll turn out.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Doug {Collins} {Saved} {Raphael} {Warnock’s} {Senate} {Bid}},
  date = {2021-02-28},
  url = {https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Doug Collins Saved Raphael Warnock’s Senate
Bid.”</span> February 28, 2021. <a href="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid">https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/index.html</guid>
  <pubDate>Sun, 28 Feb 2021 06:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-02-28-doug-collins-saved-raphael-warnock-s-senate-bid/featured.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>(Kind of) Projecting the 2020 Election</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-02-21-kind-of-projecting-the-2020-election/index.html</link>
  <description><![CDATA[ 




<p>I’m about 4 months too late, but to practice forecasting, I made a modest projection for the 2020 national popular vote using <a href="https://projects.fivethirtyeight.com/2020-general-data/presidential_polls_2020.csv">polling data</a> from the two weeks leading up to election day. In the weeks leading up to the election, aggregated polling was fairly stable, and the model projection was within 1.5% of the <a href="https://en.wikipedia.org/wiki/2020_United_States_presidential_election">actual outcome</a> (both the model and actual outcome are adjusted to exclude third parties and instead show the two-party vote share).</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-21-kind-of-projecting-the-2020-election/pics/plot_01.png" class="img-fluid"></p>
<p>The projected outcome of Biden’s vote share, 53.6%, is only the most likely outcome in a <a href="https://en.wikipedia.org/wiki/Beta_distribution">distribution of possible outcomes</a> predicted by the model. Of the possible outcomes, Biden wins the popular vote about 70% of the time, according to the November 2nd projection.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-21-kind-of-projecting-the-2020-election/pics/plot_03.png" class="img-fluid"></p>
<p>Like the projected vote share, the probability of Biden winning the popular vote remained fairly constant in the two weeks leading up to the election.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-21-kind-of-projecting-the-2020-election/pics/plot_02.png" class="img-fluid"></p>
<p>If you were like me, obsessing over the prominent forecast models prior to election day, you may notice that this projection is substantially less confident in the outcome than the leading forecasters. <a href="https://projects.fivethirtyeight.com/2020-election-forecast/">FiveThirtyEight</a> and the <a href="https://projects.economist.com/us-2020-forecast/president">Economist</a>, for example, both projected similar popular vote outcomes (within a percentage point of this forecast), but gave Biden at least a 97% of winning the popular vote! There are a couple reasons for this difference:</p>
<ul>
<li><strong>This model is one-dimensional</strong> : this is a pretty simple model built just to get practice with forecasting and some of the tools in R, so it only uses polls (and, at that, only a small subset of polls), whereas other forecast models used a wide variety of variables to inform the model (economic indicators, demographics, partisanship, etc.).</li>
<li><strong>This model doesn’t weight polls</strong> : aside from the sample size of the poll, this model doesn’t apply any weights or corrections to the polling data. The polling method, date the poll was taken, and pollster <a href="https://fivethirtyeight.com/features/calculating-house-effects-of-polling-firms/">house effect</a> (i.e., how partisan the pollster tends to be relative to the average) can be used to inflate or deflate the weight of each poll in the model. This simple model ignores all of that and treats every poll as equal.</li>
<li><strong>This model forces an uncertainty range</strong> : unlike other models, which are a set of <a href="https://en.wikipedia.org/wiki/Regression_analysis">linear regressions</a>, this model is a relatively simple <a href="https://en.wikipedia.org/wiki/Beta_distribution">beta distribution</a> of the vote, with the sum of parameters manually set to 50. This is a bit of technical mumbo-jumbo, but the gist is that a beta distribution allows you to control its “peaky-ness,” and I did this manually, whereas other forecasters had the model do it for them. Increasing the sum of parameters increases how peaky the distribution looks, and a sum of 50 was used based on <a href="http://florianmuellerklein.github.io/election/">Florian Muellerklein’s Georgia runoff model</a>, which also used a sum of 50.</li>
</ul>
<section id="some-notes" class="level1">
<h1>Some Notes</h1>
<p>As always, you can find source data and code on <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.02.21-simple_projection">github</a>. I’m pretty happy with how this turned out - I’ve been getting a bit more comfortable with R, and the tools used for this post were pretty intuitive to implement. I’m also happy with the color palette I selected (<a href="https://htmlcolorcodes.com/color-picker/">HTML Color Picker</a> is a godsend). The only improvement is that I could/should have saved quite a bit of code by writing over one of the plot themes, rather than re-writing the theme for each plot. Something to remember going forward.</p>
<p>Next week, I’ll dig into some of the county-level data from the election to see if there was any ticket splitting between the presidential election and the down-ballot races.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {(Kind of) {Projecting} the 2020 {Election}},
  date = {2021-02-21},
  url = {https://www.thedatadiary.net/posts/2021-02-21-kind-of-projecting-the-2020-election},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“(Kind of) Projecting the 2020 Election.”</span>
February 21, 2021. <a href="https://www.thedatadiary.net/posts/2021-02-21-kind-of-projecting-the-2020-election">https://www.thedatadiary.net/posts/2021-02-21-kind-of-projecting-the-2020-election</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-02-21-kind-of-projecting-the-2020-election/index.html</guid>
  <pubDate>Sun, 21 Feb 2021 06:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-02-21-kind-of-projecting-the-2020-election/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Scorecasting</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-02-14-scorecasting/index.html</link>
  <description><![CDATA[ 




<p>A baseball forecast that correctly predicts the winner of the <a href="https://www.mlb.com/schedule/2021-04-01">15 opening day games</a> could be a truly accurate model, or could just be getting lucky. Over the course of 6 months and <a href="https://en.wikipedia.org/wiki/Major_League_Baseball_schedule">2,430 regular season games</a>, however, a great forecast will continue to shine whereas an initially lucky one will falter. In data rich environments like sports, there are lots of events (games) over the course of a season to judge how well a model is performing.</p>
<p>When there aren’t a lot of events to forecast, like presidential elections that occur once every four years (quadrennially?), it’s more difficult to tell how well a forecast performs (a handful of correct/incorrect predictions could just be good/bad luck!), but forecasters still have tools available to evaluate their model. This week, I took a look at a few different methods of comparing different models.</p>
<section id="scoring-the-forecasters" class="level1">
<h1>Scoring the Forecasters</h1>
<p>The most common scoring method, the Brier score, is a measurement of a probabilistic forecast’s accuracy based on the confidence of the prediction. Each event has its own score, and the average of all predicted events is the model’s Brier score. Highly confident predictions are highly rewarded/punished for their accuracy/inaccuracy, whereas timid predictions don’t move the needle too much, regardless of the outcome. Scores can range from 0.00 to 1.00, with 0.00 being a perfect score (you can read more about Brier scores <a href="https://en.wikipedia.org/wiki/Brier_score">here</a>, but the gist is that the lower the score, the better). In presidential forecasts, each state can be considered an event.</p>
<p>Oftentimes, presidential forecasters report Brier scores as weighted by each state’s number of electors. Correctly predicting Texas’ winner in this scoring system is far more important than correctly predicting Wyoming’s winner, given that Texas’ 38 electoral votes far overshadow Wyoming’s 3. I’m not quite convinced that this is the most meaningful way to evaluate models (California is pretty easy to predict and heavily weighted by its 55 electoral votes, but most of us were more concerned with Georgia’s outcome, despite being undervalued by this scoring method), but <a href="https://projects.jhkforecasts.com/presidential-forecast/forecast-analysis">forecasters do use this scoring method</a>.</p>
<p>Finally, I came up with my own scoring method that makes a “bet” between $0 and $100 based on prediction confidence. 100% confidence would turn into a $100 bet, and 50% confidence (aka, a coin toss) would be a $0 bet. Each model’s average winnings (including losses) is reported as the score.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-02-14-scorecasting/pics/pic_01.png" class="img-fluid"></p>
<p>I scored a few prominent presidential forecasts based on the above methodologies (you can read more about the <a href="https://projects.jhkforecasts.com/presidential-forecast/">JHK</a>, <a href="https://projects.economist.com/us-2020-forecast/president">Economist</a>, <a href="https://projects.fivethirtyeight.com/2020-election-forecast/">FiveThirtyEight</a>, and <a href="https://thecycle.news/news/september-2020-election-update">Bitecofer</a> forecasts at the links here). While all the scoring methods are similar - rewarding confidence in correct predictions and penalizing meek or incorrect predictions - each model’s performance is all over the map (with perhaps the exception of Bitecofer, which scores in the lower half of all methods). But does that mean these methods are useless? No! If anything, it highlights the importance that each forecast method’s performance should be scored across a wide variety of scoring methodologies. While it might not make a huge difference at the margins, it may separate some models as clearly ahead or behind the curve.</p>
<p>So, how does each forecast model measure up? It depends on which yardstick you use!</p>
<p>Here are some other things to consider with regards to each model:</p>
<ul>
<li>Unlike the Economist, FiveThirtyEight, and Bitecofer models, which simulate each state’s outcome thousands of times and reports the confidence as the percentage of simulations won, the JHK forecast reports the percentage of winning results that fall within the 80% confidence interval around the expected vote. <a href="https://en.wikipedia.org/wiki/Standard_deviation#/media/File:Standard_deviation_diagram.svg">Lower confidence intervals result in tighter bands</a>, so this relatively low confidence interval means that the model is allowed to make quite a few 100% confident predictions (which, luckily for the model, all came true in this case).</li>
<li>The Bitecofer forecast is the only model that doesn’t utilize polls and instead uses an in-house developed negative-partisanship model.</li>
<li>Based on conversations between Nate Silver of FiveThirtyEight and Elliott Morris of the Economist, it appears that <a href="https://fivethirtyeight.com/features/our-election-forecast-didnt-say-what-i-thought-it-would/">FiveThirtyEight added a bit of uncertainty ad-hoc</a> to account for COVID, whereas <a href="https://www.reddit.com/r/IAmA/comments/jjr0wk/im_elliott_morris_a_data_journalist_at_the/gaeefhv?context=3&amp;utm_medium=web2x&amp;utm_source=share">the Economist did not</a>.</li>
</ul>
<p>As always, source files and code can be found on <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.02.14-scorecasting">github</a>. Next week, I plan on making a relatively modest prediction of the election’s popular vote outcome based on polls from the final week.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Scorecasting},
  date = {2021-02-14},
  url = {https://www.thedatadiary.net/posts/2021-02-14-scorecasting},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Scorecasting.”</span> February 14, 2021. <a href="https://www.thedatadiary.net/posts/2021-02-14-scorecasting">https://www.thedatadiary.net/posts/2021-02-14-scorecasting</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-02-14-scorecasting/index.html</guid>
  <pubDate>Sun, 14 Feb 2021 06:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-02-14-scorecasting/featured.png" medium="image" type="image/png" height="31" width="144"/>
</item>
<item>
  <title>Some Worthwhile Links</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-02-08-some-worthwhile-links/index.html</link>
  <description><![CDATA[ 




<p>Rather than diving deep into a topic this week, I took a bit of a break to focus on playing catchup with the stats course I’m taking. Instead, I’ve listed out below a number of creators that I follow on various platforms. If you’re interested in data or critical thinking, each is well worth your time and attention.</p>
<section id="newsletters" class="level1">
<h1>Newsletters</h1>
<ul>
<li><a href="https://fivethirtyeight.com/">FiveThirtyEight</a> : While it’s not technically a newsletter, the FiveThirtyEight site, created by statistician Nate Silver prior to the 2008 presidential election, is the original source for data-driven news (or, at least, one of the first sites to popularize data as a news resource). Nate created the site specifically because the narrative created by pundits, that the 2008 election was super close, was pretty easily refutable when you looked at the polling data, which showed that Obama was going to win handily. Now, FiveThirtyEight is a powerhouse of data analysis for politics, sports, and science, and often serves as a good reality check against the narratives espoused by talking heads on the major news networks.<br>
</li>
<li><a href="https://gelliottmorris.substack.com/">G. Elliott Morris’ Newsletter</a> : G. Elliott Morris is a data journalist for the Economist and created their forecast for the 2020 presidential election. In addition to regularly writing for the Economist, Elliott also writes a weekly newsletter in which he comments on polls that caught his eye (he also has a subscriber newsletter, for those who want to get his thoughts on even more topics). Elliott is also writing a book on the history of public polls, their limitations, and their future in American politics, which I am looking forward to reading when it releases later this year. As an aside, Elliott and I are the same age, and he was a large part of the inspiration for me to start diving into statistics again (i.e., if he can do it, so can I). Elliot is pretty bearish on the future of American democracy, especially following Donald Trump’s repeated attempts to overturn the overwhelmingly clear and overwhelmingly fair results of the election and the attempted (but, thankfully, woefully unorganized) coup by insurrectionists on Jan.&nbsp;6th. Despite all this, I’m a bit more hopeful for the future of democracy, and hope to be able to provide a more positive opinion alongside Elliott’s (provided it’s supported by the data!).</li>
<li><a href="https://infinitemonkeys.substack.com/">Infinite Monkeys</a> : Started by a collection of college students who met via #ElectionTwitter, the Infinite Monkeys newsletter (named such from the theory that, an infinite collection of monkeys hitting keys on typewriters will eventually write the entirety of Shakespeare’s work by random chance) take a look at geographical trends and their relation to current political headlines. It’s a relatively recent startup, and I’m looking forward to the development of the newsletter &amp; its coalition of authors over the coming years.</li>
<li><a href="https://visualnoise.substack.com/">Visual in the Noise</a> : The Visual in the Noise is a weekly newsletter focused on data visualization. Most often looking at sports (particularly, NBA) data, the Visual in the Noise is a great touch-point for the importance of visualization and how it can help make data more insightful.</li>
</ul>
</section>
<section id="podcasts" class="level1">
<h1>Podcasts</h1>
<ul>
<li><a href="https://www.nytimes.com/column/the-daily">The Daily</a> : The Daily is, appropriately, a daily (Mon. - Fri.) podcast hosted by the New York Times, covering important topics in the American landscape. The podcast generally focuses in on individuals, and how national stories can affect people personally (for example, touching base with a bar throughout the pandemic as they wade through the difficulties of diminished business, PPP applications, and unclear direction from the government). On Sundays, a guest reads an older, long form New York Times piece.</li>
<li><a href="https://theintelligence.economist.com/">The Intelligence</a> : The Intelligence, similarly to the Daily, is a daily weekday podcast covering important topics in the news, though typically has a more global focus than the Daily. Rather than following individuals, the Intelligence often brings in subject matter experts and local correspondents.</li>
<li><a href="https://www.economist.com/checks-and-balance-our-weekly-podcast-on-american-politics">Checks and Balance</a> : This weekly podcast by the Economist takes a deep dive into one big topic shaping American politics each week. Approximately 45 minutes per podcast, the Checks and Balance hosts take care to thoroughly explore each topic.</li>
<li><a href="https://fivethirtyeight.com/podcasts/">FiveThirtyEight’s Politics Podcast</a> : Every week, the FiveThirtyEight team covers the latest news in politics, utilizing polling data to guide their discussion. During election years, they also host intermittent “Model Talks,” where Nate Silver talks about into some of the intricacies of the site’s forecast models based on questions from listeners.<br>
</li>
<li><a href="https://rationalreminder.ca/podcast-directory">The Rational Reminder</a> : A non-politics podcast, the Rational Reminder is a weekly podcast discussing index investing and rational decision making. Although the podcast is made by and for Canadians, most of the content is widely applicable, and the podcast has garnered an international audience.</li>
</ul>
</section>
<section id="youtube" class="level1">
<h1>YouTube</h1>
<ul>
<li><a href="https://www.youtube.com/channel/UCYO_jab_esuFRV4b17AJtAw">3blue1brown</a> : Many concepts in math can feel daunting and teaching methods are often unintuitive. Grant Sanderson’s channel attempts to introduce viewers to the beauty of math through intuitive visualizations and animations. As a fun fact, the animations are run via a python package, manim, developed on-the-fly by Grant himself!</li>
<li><a href="https://www.youtube.com/user/sxephil">Philip DeFranco</a> : One of the original members of the YouTube community, Phil has grown from a weekly commentary on popular videos via a webcam in his bedroom to a daily rundown of the news backed by a full production staff. Phil does an excellent job of presenting the news whilst making it clear where the official reporting stops and his opinion starts.</li>
<li><a href="https://www.youtube.com/channel/UCpa-Zb0ZcQjTCPP1Dx_1M8Q">Legal Eagle</a> : Dubbed “YouTube’s Lawyer,” Devin (DJ) Stone provides a perspective on the role the law plays in current events and controversies (as well as more fun videos, like reviewing a Spongebob episode for legal accuracy). I’m not sure how he manages to balance the two full time jobs of running channel with near-daily longform content and being a lawyer with active litigation, but I appreciate that he is able to find time for thoughtful (and often comedic) insight.<br>
</li>
<li><a href="https://www.youtube.com/channel/UCDXTQ8nWmx_EhZ2v-kp7QxA">Common Sense Investing</a> : Ben Felix’s Common Sense Investing investigates the academic research supporting passive, rather than active, portfolio management (in summary: the data shows that passive index investing is overwhelmingly a more effective long term investment strategy than trusting an active portfolio manager with your money).</li>
<li><a href="https://www.youtube.com/user/standupmaths">Standup Maths</a> : Mathematician, comedian, and Excel-enthusiast Matt Parker shares the joy that can be found in math by exploring topics in a comedic setting. Matt’s book, Humble Pi, explores some of history’s most famous mathematical blunders, and is coming up soon on my reading list.</li>
<li><a href="https://www.youtube.com/user/numberphile">Numberphile</a> : The Numberphile channel is a collection of interviews of prominent mathematicians explaining interesting historical math problems on trademark brown parchment paper. Grant Sanderson and Matt Parker make appearances on the channel a number of times (the infamous Parker square first made its appearance on Numberphile).</li>
<li><a href="https://www.youtube.com/user/minutephysics/featured">MinutePhysics</a> : As Henry Reich, the channel owner, puts it, the channel is simply about “cool physics and other sweet science.” Henry’s videos explain concepts in physics via a whiteboard, expo markers, and a backdrop of jazzy standup bass.</li>
</ul>
</section>
<section id="election-twitter" class="level1">
<h1>Election Twitter</h1>
<div class="alert-info">
<p><em>There are quite a few, so I’ll just highlight a few &amp; link ot the rest</em></p>
</div>
<ul>
<li><a href="https://twitter.com/lxeagle17">Lakshya Jain</a> : Lakshya is a software engineer and self-described amateur elections mapper/analyst. He’s a very vocal (and self-labeled) partisan democrat, so I take his non-analytical posts with a grain of salt, but his analytical posts are very insightful.</li>
<li><a href="https://twitter.com/jhkersting">Jack Kersting</a> : A relative rarity on Election Twitter, Jack is a conservative forecaster. He’s not an ardent twitter user, but developed one of the most complete and thorough election forecasts I’ve seen outside of professional work.</li>
<li><a href="https://twitter.com/maxtmcc">Max</a> : A self described mapmaker, shitposter, and ardent supporter of Long Nebraska, Max is known for his oddball posts and lukewarm political takes.</li>
<li>Some other folks I follow for election maps/data: <a href="https://twitter.com/NateSilver538">Nate Silver</a>, <a href="https://twitter.com/gelliottmorris">G. Elliott Morris</a>, <a href="https://twitter.com/umichvoter99">U Mich Voter</a>, and <a href="https://twitter.com/norwood270">Sam</a></li>
</ul>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {Some {Worthwhile} {Links}},
  date = {2021-02-08},
  url = {https://www.thedatadiary.net/posts/2021-02-08-some-worthwhile-links},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“Some Worthwhile Links.”</span> February 8,
2021. <a href="https://www.thedatadiary.net/posts/2021-02-08-some-worthwhile-links">https://www.thedatadiary.net/posts/2021-02-08-some-worthwhile-links</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <guid>https://www.thedatadiary.net/posts/2021-02-08-some-worthwhile-links/index.html</guid>
  <pubDate>Mon, 08 Feb 2021 06:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-02-08-some-worthwhile-links/icon.png" medium="image" type="image/png" height="132" width="144"/>
</item>
<item>
  <title>The Min-Wage Debate</title>
  <dc:creator>Mark Rieke</dc:creator>
  <link>https://www.thedatadiary.net/posts/2021-01-31-the-min-wage-debate/index.html</link>
  <description><![CDATA[ 




<p>On January 26, House Democrats introduced a <a href="https://twitter.com/nbcnews/status/1354102510101868547?s=21">bill to raise the federal minimum wage</a> from $7.25 per hour to $15 per hour by 2025. In the weeks leading up to the introduction, there’s been an influx on twitter of <a href="https://twitter.com/laurenboebert/status/1353102326744166409?s=21">bad faith attacks</a>, outright <a href="https://twitter.com/JoshuaConkel/status/1350228946361622528?s=20">factually incorrect statements</a>, and the type of fact-free arguments that <a href="https://www.washingtonpost.com/news/wonk/wp/2012/10/10/in-excitable-pundits-vs-political-scientists-ill-take-political-scientists-every-time/">pundits love</a> (to be fair, my twitter timeline is biased towards my left-leaning friends, so the majority of what I see are poorly formulated left-leaning takes, but it’s pretty easy to find similarly <a href="https://www.prageru.com/">bad right-leaning takes</a>). The slew of emotion-driven arguments muddies the water around the minimum wage discussion by avoiding references to data. In an effort to find the signal in all this noise, I dug into publicly available databases to hopefully provide at least one opinion grounded in empiricism, rather than emotion.</p>
<section id="my-priors" class="level1">
<h1>My Priors</h1>
<p>For transparency’s sake, prior to taking a look into the data behind the minimum wage debate, I was of the belief that the minimum wage should increase and that the proposed $15 per hour seemed reasonable. I didn’t have an empirically driven reason for this belief, just a vague sense that the minimum wage hadn’t risen in a while and had therefore effectively been deflating. Anecdotally, I also hadn’t seen a good defense of keeping the minimum wage static (in fact, most of the arguments against raising the minimum wage that I’d seen were <a href="https://www.forbes.com/sites/laurashin/2013/07/18/why-mcdonalds-employee-budget-has-everyone-up-in-arms/?sh=4bb3106a5216">laughably bad</a>). My prior was built on little data, so the analysis I set out to do would either strongly confirm or refute it.</p>
</section>
<section id="the-history-of-the-minimum-wage" class="level1">
<h1>The History of the Minimum Wage</h1>
<p>In 1947, the federal government introduced a minimum wage for hourly-compensated labor as part of an amendment to the Fair Labor Standards Act (FLSA). First set at $0.40 per hour, the minimum wage has risen periodically throughout its 80 year history - most recently rising to $7.25 per hour in 2009. Currently, <a href="https://www.ncsl.org/research/labor-and-employment/state-minimum-wage-chart.aspx#:~:text=Saige%20Draeger-,Summary,wage%20below%20%247.25%20per%20hour.">29 states and D.C.</a> have state minimum wages greater than the minimum wage, and several state minimum wages are increasing in 2021 (either due to ballot initiatives or automatic increases based on cost of living).</p>
<p>I’ve seen a theory float around that, <a href="https://twitter.com/nytopinion/status/1215889657571028992">had the minimum wage risen with inflation, it would be $22 per hour</a> today, rather than $7.25 per hour. This is pretty overtly false.* Using the <a href="https://fred.stlouisfed.org/series/CPIAUCSL">consumer price index</a> (CPI) as the standard measure of inflation, the nominal minimum wage throughout the years can be adjusted to real (aka, inflation-adjusted) dollars:</p>
<p>In inflation-adjusted terms, the minimum wage peaked around 1968 at $12.20 per hour ($1.60 per hour, unadjusted). The current minimum wage of $7.25 per hour, while on the lower end of inflation-adjusted historical values, is not the lowest it’s ever been, and a $15 per hour minimum wage would set a new record for both adjusted and unadjusted minimum wage. Critics of the proposed increase may point to this as reason to keep the minimum wage at its current value - why increase the minimum wage beyond its historical high if it hasn’t even reached its historical low? Supporters, on the other hand, may argue that the minimum wage has never been enough.</p>
</section>
<section id="the-minimum-wages-dance-between-two-thresholds" class="level1">
<h1>The Minimum Wage’s Dance Between Two Thresholds</h1>
<p>In 1978, the Census Bureau and Department of Health and Human Services set a baseline administrative threshold to determine eligibility for financial assistance from the federal government. Dubbed the “<a href="https://www.census.gov/data/tables/time-series/demo/income-poverty/historical-poverty-thresholds.html">poverty threshold</a>,” this value was created based on an approximation of the annual budget various family units require to meet basic food &amp; shelter needs (for example, a single adult with no children would need to earn less per hour to meet his needs than, say, a nuclear family of two working adults and two children). The Census Bureau updates the threshold annually by simply adjusting for inflation.</p>
<p>Many groups, however, argue that the poverty threshold doesn’t meet basic needs and instead advocate for a <a href="https://www.investopedia.com/terms/l/living_wage.asp">living wage</a>. The living wage is similar in concept to the poverty threshold, but generally much higher, as it includes an expanded food budget (the poverty threshold is based on <a href="https://www.fns.usda.gov/cnpp/usda-food-plans-cost-food-reports-monthly-reports">USDA’s “thrifty” food plan</a>), a budget cap on rent (generally set at ~30% of a monthly budget), healthcare, and childcare, amongst other additions.</p>
<p>Based on <a href="https://livingwage.mit.edu/">MIT Lab’s Living Wage Calculator</a>, we can see that, for a family of four with two working adults, the minimum wage has historically been marginally greater than the poverty threshold, but never reaches (or approaches) the living wage:</p>
<p><img src="https://www.thedatadiary.net/posts/2021-01-31-the-min-wage-debate/pics/plot_02.png" class="img-fluid"></p>
<p>Figure 2, above, shows the national minimum and living wages, but these values vary by location. Figure 3 below shows the minimum and living wages for each state. Even states with minimum wages greater than the federal minimum do not meet the local living wage:</p>
<p><img src="https://www.thedatadiary.net/posts/2021-01-31-the-min-wage-debate/pics/plot_03.png" class="img-fluid"></p>
</section>
<section id="the-proposed-increase" class="level1">
<h1>The Proposed Increase</h1>
<p>So how does the proposed increase to the minimum wage fare against the living wage and poverty threshold in the future? If inflation continues to hold at about <a href="https://www.pwlcapital.com/how-pwl-estimates-future-inflation/">1.6%</a>, the increased minimum wage will get significantly closer to, but not greater than, the living wage in 2025.</p>
<p><img src="https://www.thedatadiary.net/posts/2021-01-31-the-min-wage-debate/pics/plot_04.png" class="img-fluid"></p>
<p>Is this enough? Arguably, no, as the proposed increase is less than the estimated living wage. But it is certainly a step in the right direction, and if passed, would likely keep the minimum wage above the poverty threshold for quite some (the poverty threshold rises roughly at a rate of $1 per hour every 10 years).</p>
</section>
<section id="my-posterior" class="level1">
<h1>My Posterior</h1>
<p>In general, my prior was confirmed by the analysis - my belief that the minimum wage should be increased has strengthened, and there’s a believable argument that the $15 per hour increase could be raised even higher. There are some additional points that I didn’t discuss above, however, that are still worth noting:</p>
<ul>
<li>There are many different groups that have estimated living wages, and results can vary (I used MIT Lab’s data because it was the most readily available &amp; also provided state, county, and metropolitan level data). In general, however, living wage estimates agree that the poverty threshold is far too low, and typically show living wages in excess of $15 per hour.</li>
<li>The percentage of hourly workers earning the federal minimum wage (or less) has <a href="https://usafacts.org/articles/minimum-wage-america-how-many-people-are-earning-725-hour/">decreased over the years</a> and currently rests at about 1.9%. This is in part due to many states having minimum wages greater than the federal minimum. If the minimum wage increases to $15 per hour, the total number of workers earning the federal minimum wage will likely increase (the linked chart shows spikes that correspond to minimum wage increases in the ’90s and 2009).</li>
<li>Some critics of the increased minimum wage argue that the minimum wage is only meant for teenagers working summer jobs. The data doesn’t support this argument - over <a href="https://www.bls.gov/opub/reports/minimum-wage/2019/home.htm#cps_mw_whe_hist.f.1">80% of federal minimum wage workers are 20+ years old</a>.</li>
<li>In 2019, the Congressional Budget Office released <a href="https://www.cbo.gov/system/files/2019-07/CBO-55410-MinimumWage2019.pdf">a report</a> that estimated that job losses due to an increased minimum wage could range between 4.7 million and 0, with a median of 1.3 million lost jobs. The report also notes, however, that about 17 million workers would benefit from the wage increase.</li>
</ul>
<blockquote class="blockquote">
<p>The linked NYT opinion article does give itself the caveat that the $22 per hour figure is based on “inflation and productivity,” though <a href="https://twitter.com/JoshuaConkel/status/1350228946361622528?s=20">others</a> have repeated this $20+ per hour wage argument without this caveat. The <a href="https://www.nytimes.com/2020/01/09/opinion/sunday/deaths-despair-poverty.html">opinion article</a> doesn’t mention any sources or databases, though I expect that the author is using GDP as a proxy for inflation - several articles point out that if the minimum wage had <a href="https://www.counterpunch.org/2020/01/24/what-the-minimum-wage-would-be-if-it-kept-pace-with-productivity/">kept pace with GDP growth since 1968</a>, it’d be significantly greater than even the proposed $15 per hour minimum wage. Correlating this to inflation, however, is at best a significant oversight by the author/editor, and at worst intentionally deceptive.</p>
</blockquote>
</section>
<section id="some-other-notes" class="level1">
<h1>Some Other Notes</h1>
<p>As always, source data for this post can be found on <a href="https://github.com/markjrieke/thedatadiary/tree/main/2021.01.31-minwage">github</a>. I made an overt attempt to keep the code a bit cleaner this time around (having a “test area” in the code helped out). It’s still not perfect, and I suspect I’ll just naturally get better at writing neatly formatted scripts as the language becomes more intuitive.</p>
<p>I think I’m going to take a break for a couple weeks from some of these longer posts - I’m currently finishing this a bit after midnight (which is very late for me!) - and between writing this &amp; the Bayes’ Theorem post, I’ve had little time to dedicate to stats. Next week, I’ll put together a less intensive piece to give myself time to push forward with the stats class. Maybe after that I can write a quick post about the accuracy of prediction models, then get into another deep dive. We’ll see how I feel about it in the next couple weeks.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><div>MIT</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rieke2021,
  author = {Mark Rieke},
  title = {The {Min-Wage} {Debate}},
  date = {2021-01-31},
  url = {https://www.thedatadiary.net/posts/2021-01-31-the-min-wage-debate},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rieke2021" class="csl-entry quarto-appendix-citeas">
Mark Rieke. 2021. <span>“The Min-Wage Debate.”</span> January 31, 2021.
<a href="https://www.thedatadiary.net/posts/2021-01-31-the-min-wage-debate">https://www.thedatadiary.net/posts/2021-01-31-the-min-wage-debate</a>.
</div></div></section></div> ]]></description>
  <category>archive</category>
  <category>politics</category>
  <guid>https://www.thedatadiary.net/posts/2021-01-31-the-min-wage-debate/index.html</guid>
  <pubDate>Sun, 31 Jan 2021 06:00:00 GMT</pubDate>
  <media:content url="https://www.thedatadiary.net/posts/2021-01-31-the-min-wage-debate/featured.png" medium="image" type="image/png" height="78" width="144"/>
</item>
</channel>
</rss>
